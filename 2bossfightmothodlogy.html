<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Fight: Quizz M√©thodologies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@400;600;700&display=swap');

        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-green: #00ff41;
            --neon-yellow: #ffee00;
            --neon-red: #ff3333;
            --dark-bg: #0d0d15;
        }

        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 243, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 0, 255, 0.05) 0%, transparent 20%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .pixel-font { font-family: 'Press Start 2P', cursive; }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }

        .boss-idle { animation: float 3s ease-in-out infinite; }
        .shake-element { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        .glitch-text { animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite; color: var(--neon-red); }
        
        .health-bar-container {
            background: #222;
            border: 2px solid #444;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .health-bar-fill {
            height: 100%;
            transition: width 0.5s ease-out, background-color 0.3s;
        }

        .glass-panel {
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        .card-hover:hover {
            transform: translateY(-5px);
            border-color: var(--neon-blue);
            box-shadow: 0 5px 15px rgba(0, 243, 255, 0.15);
        }

        /* Tab Styles in Modal */
        .tab-btn {
            padding: 8px 16px;
            border-bottom: 2px solid transparent;
            color: #9ca3af;
            transition: all 0.3s;
        }
        .tab-btn.active {
            color: var(--neon-blue);
            border-bottom-color: var(--neon-blue);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a20; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-blue); }

        .hidden { display: none !important; }
    </style>
</head>
<body class="p-2 md:p-4 w-full text-white">

    <!-- TOP UI -->
    <div class="fixed top-0 left-0 w-full p-4 flex justify-between items-start z-50 pointer-events-none">
        <div class="text-[10px] md:text-xs text-gray-500 font-mono pointer-events-auto">
            SYSTEM: ONLINE<br>V.5.1.FINAL
        </div>
        <!-- Added mr-14 to push buttons left away from the edge -->
        <div class="flex gap-1 pointer-events-auto bg-black/50 p-1 rounded backdrop-blur-sm mr-14">
            <button onclick="setLanguage('mg')" class="px-2 py-1 rounded hover:bg-white/10 text-xs font-bold transition border border-transparent hover:border-green-500 opacity-50" id="btn-mg">MG</button>
            <button onclick="setLanguage('fr')" class="px-2 py-1 rounded hover:bg-white/10 text-xs font-bold transition border border-transparent hover:border-blue-500" id="btn-fr">FR</button>
            <button onclick="setLanguage('en')" class="px-2 py-1 rounded hover:bg-white/10 text-xs font-bold transition border border-transparent hover:border-purple-500 opacity-50" id="btn-en">EN</button>
        </div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="w-full max-w-5xl mx-auto my-auto relative pt-12">

        <!-- SCREEN 1: LANDING -->
        <div id="landing-screen" class="text-center space-y-6 animate-fade-in py-10">
            <h1 class="text-3xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 pixel-font leading-tight filter drop-shadow-[0_0_15px_rgba(0,243,255,0.3)]">
                BOSS FIGHT
            </h1>
            <h2 class="text-lg md:text-2xl text-gray-400 font-semibold tracking-[0.2em] uppercase" data-key="subtitle">
                Quizz des M√©thodologies
            </h2>

            <div class="glass-panel p-6 md:p-10 rounded-2xl max-w-lg mx-auto border-t-4 border-blue-500 mt-8">
                <p class="mb-8 text-gray-300 text-sm md:text-base leading-relaxed" data-key="introText">
                    Affrontez le Boss de l'Ignorance ! Testez vos connaissances sur 8 m√©thodologies d'apprentissage.
                </p>
                
                <button onclick="startGame()" class="group relative inline-flex items-center justify-center px-8 py-4 font-bold text-white transition-all duration-200 bg-blue-600 font-lg rounded-lg hover:bg-blue-500 hover:shadow-[0_0_20px_rgba(0,100,255,0.6)] focus:outline-none ring-offset-2 focus:ring-2 ring-blue-400">
                    <span class="pixel-font text-sm md:text-base" data-key="startBtn">START GAME</span>
                    <div class="absolute inset-0 rounded-lg ring-2 ring-white/20 group-hover:ring-white/40"></div>
                </button>
            </div>

            <div class="mt-12 opacity-80 hover:opacity-100 transition">
                <p class="text-[10px] text-gray-500 mb-2 uppercase tracking-widest" data-key="haveCode">Avez-vous le code ?</p>
                <div class="flex justify-center gap-2">
                    <input type="text" id="secret-code-input" placeholder="CODE" class="bg-gray-800/80 border border-gray-700 rounded px-3 py-2 text-center tracking-widest uppercase focus:outline-none focus:border-blue-500 w-28 text-sm text-white">
                    <button onclick="checkCode()" class="bg-blue-900/50 hover:bg-blue-800 text-blue-200 px-3 py-2 rounded font-bold border border-blue-800 text-sm">OK</button>
                </div>
                <p id="code-error" class="text-red-400 text-[10px] mt-2 h-4 transition-opacity opacity-0">Code Invalide</p>
            </div>
        </div>

        <!-- SCREEN 2: GAME ARENA -->
        <div id="game-screen" class="hidden flex-col w-full">
            
            <!-- HUD -->
            <div class="flex justify-between items-end mb-6 bg-black/30 p-3 rounded-xl border border-white/5">
                <div class="w-[45%]">
                    <div class="flex justify-between text-[10px] md:text-xs font-bold mb-1 uppercase tracking-wider">
                        <span class="text-blue-400">Player</span>
                        <span id="player-hp-text">100/100</span>
                    </div>
                    <div class="health-bar-container">
                        <div id="player-hp-bar" class="health-bar-fill bg-blue-500 w-full shadow-[0_0_10px_#3b82f6]"></div>
                    </div>
                </div>
                
                <div class="text-xl md:text-3xl font-bold pixel-font text-yellow-500 animate-pulse mx-2">VS</div>

                <div class="w-[45%] text-right">
                    <div class="flex justify-between text-[10px] md:text-xs font-bold mb-1 uppercase tracking-wider">
                        <span id="boss-hp-text">100/100</span>
                        <span class="text-red-500" data-key="bossName">Ignorance</span>
                    </div>
                    <div class="health-bar-container">
                        <div id="boss-hp-bar" class="health-bar-fill bg-red-600 w-full float-right shadow-[0_0_10px_#dc2626]"></div>
                    </div>
                </div>
            </div>

            <!-- BATTLE CONTENT -->
            <div class="flex flex-col md:flex-row gap-4 md:gap-6 min-h-[420px]">
                
                <!-- BOSS CARD -->
                <div class="w-full md:w-1/3 glass-panel rounded-xl flex flex-col items-center justify-center p-6 relative overflow-hidden border border-red-900/30 min-h-[200px]">
                    <div id="boss-visual" class="boss-idle mb-6 transition-transform">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="filter drop-shadow-[0_0_15px_rgba(239,68,68,0.6)]">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                            <line x1="8" y1="21" x2="16" y2="21"></line>
                            <line x1="12" y1="17" x2="12" y2="21"></line>
                            <path d="M9 10a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z" fill="currentColor"></path>
                            <path d="M15 10a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z" fill="currentColor"></path>
                            <path d="M9 14h6"></path>
                        </svg>
                    </div>
                    <div class="text-center w-full">
                        <div class="inline-block px-2 py-0.5 rounded bg-gray-800 text-[10px] text-gray-400 mb-2 border border-gray-700">TOPIC</div>
                        <h3 id="question-category" class="text-lg font-bold text-white mb-2 leading-tight">...</h3>
                        <div class="h-0.5 w-12 bg-red-500/50 mx-auto rounded"></div>
                    </div>
                </div>

                <!-- QUESTION INTERFACE -->
                <div class="w-full md:w-2/3 glass-panel rounded-xl p-4 md:p-6 flex flex-col border border-blue-500/20 relative">
                    <!-- Progress Header -->
                    <div class="flex justify-between items-center text-gray-500 text-xs mb-4 border-b border-gray-700 pb-2">
                        <span id="question-counter" class="font-mono text-blue-400">Q: 01/12</span>
                        <span id="difficulty-badge" class="px-2 py-0.5 rounded bg-yellow-900/30 text-yellow-500 border border-yellow-700/50">LEVEL 1</span>
                    </div>

                    <!-- Question Text -->
                    <p id="question-text" class="text-base font-medium leading-relaxed mb-6 min-h-[3rem]">
                        Loading...
                    </p>

                    <!-- DYNAMIC INTERACTION AREA -->
                    <div id="interaction-area" class="flex-grow flex flex-col justify-center">
                        <!-- Standard Buttons (Injected) -->
                        <div id="answers-container" class="grid grid-cols-1 gap-2.5"></div>
                    </div>
                    
                    <!-- Feedback Footer -->
                    <div id="feedback-area" class="mt-4 min-h-[1.5rem] flex items-center justify-center font-bold text-sm tracking-widest uppercase opacity-0 transition-opacity">
                        <!-- Feedback text -->
                    </div>
                </div>
            </div>
        </div>

        <!-- SCREEN 3: VICTORY / ARCHIVES -->
        <div id="victory-screen" class="hidden w-full pb-10">
            
            <div class="text-center mb-10 animate-float">
                <h2 class="text-4xl md:text-6xl font-bold text-yellow-400 pixel-font mb-4 drop-shadow-[0_0_20px_rgba(255,215,0,0.5)]">VICTORY</h2>
                <p class="text-blue-200 text-sm md:text-base" data-key="unlockMsg">Archives S√©cr√®tes D√©verrouill√©es</p>
            </div>

            <div class="bg-gray-900/80 border border-yellow-500/30 rounded-lg p-6 mb-12 max-w-md mx-auto text-center relative overflow-hidden group">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-yellow-500 to-transparent"></div>
                <p class="text-[10px] text-yellow-600 uppercase tracking-widest mb-2" data-key="saveCode">Sauvegardez ce code :</p>
                <p class="text-3xl md:text-4xl font-mono font-bold text-white tracking-[0.2em] select-all cursor-pointer hover:text-yellow-200 transition">TINKER25</p>
            </div>

            <h3 class="text-xl md:text-2xl font-bold mb-6 text-left border-l-4 border-blue-500 pl-4 text-white" data-key="bonusTitle">
                M√âTHODOLOGIES BONUS
            </h3>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6 mb-12">
                <!-- Cards generated via JS -->
                <div id="bonus-grid" class="contents"></div>
            </div>
            
            <div class="text-center">
                 <button onclick="location.reload()" class="bg-gray-800 hover:bg-gray-700 text-gray-300 py-3 px-8 rounded border border-gray-600 text-xs uppercase tracking-widest font-bold transition">
                    Replay
                </button>
            </div>
        </div>

        <!-- SCREEN 4: DEFEAT -->
        <div id="defeat-screen" class="hidden w-full h-full flex flex-col items-center justify-center text-center pb-20">
            <div class="mb-8 relative">
                <div class="text-6xl md:text-8xl glitch-text mb-4">‚ò†</div>
                <h2 class="text-4xl md:text-6xl font-bold text-red-600 pixel-font mb-4" data-key="gameOverTitle">GAME OVER</h2>
                <p class="text-gray-400 text-sm md:text-lg" data-key="endGameLose">L'Ignorance l'emporte...</p>
            </div>
            
            <button onclick="location.reload()" class="bg-red-900/50 hover:bg-red-800 text-red-200 py-4 px-10 rounded border border-red-600 text-sm uppercase tracking-widest font-bold transition transform hover:scale-105 shadow-[0_0_20px_rgba(220,38,38,0.4)]">
                Try Again
            </button>
        </div>
    </div>

    <!-- MODAL POPUP (ENRICHED) -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/90 z-[100] hidden flex items-center justify-center p-2 md:p-4 backdrop-blur-sm" onclick="closeModal()">
        <div class="glass-panel w-full max-w-4xl max-h-[90vh] overflow-hidden rounded-xl border border-gray-600 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col relative" id="modal-content" onclick="event.stopPropagation()">
            
            <!-- Close Button (Improved) -->
            <button onclick="closeModal()" class="absolute top-4 right-4 z-50 text-white bg-black/40 hover:bg-red-600/80 rounded-full w-12 h-12 flex items-center justify-center transition border-2 border-white/20 hover:border-white shadow-lg text-xl font-bold">‚úï</button>

            <!-- Modal Header -->
            <div class="relative bg-gradient-to-r from-blue-900 to-purple-900 p-6 flex-shrink-0 pr-20"> <!-- Added pr-20 to avoid overlap with large close button -->
                <h2 id="modal-title" class="text-2xl md:text-3xl font-bold text-white mb-1 shadow-black drop-shadow-md">Title</h2>
                <div class="flex gap-4 mt-4 text-sm font-semibold flex-wrap">
                    <button onclick="switchTab('concept')" id="tab-concept" class="tab-btn active">Concept</button>
                    <button onclick="switchTab('details')" id="tab-details" class="tab-btn">Approfondir</button>
                    <button onclick="switchTab('refs')" id="tab-refs" class="tab-btn">R√©f√©rences</button>
                </div>
            </div>
            
            <!-- Scrollable Content -->
            <div class="p-6 md:p-8 overflow-y-auto flex-grow bg-gray-900/50">
                
                <!-- TAB 1: CONCEPT -->
                <div id="content-concept" class="space-y-6">
                    <div class="bg-blue-900/20 p-4 rounded border-l-4 border-blue-500">
                        <p id="modal-concept" class="text-gray-200 text-lg leading-relaxed">...</p>
                    </div>
                    
                    <div>
                         <h3 class="text-sm font-bold text-yellow-400 uppercase mb-4 flex items-center gap-2">
                            <span>‚ö°</span> Tips & Tricks
                        </h3>
                        <ul id="modal-tips" class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-300"></ul>
                    </div>
                </div>

                <!-- TAB 2: DETAILS -->
                <div id="content-details" class="hidden space-y-4">
                    <h3 class="text-xl font-bold text-white mb-2">Description G√©n√©rale</h3>
                    <p id="modal-description" class="text-gray-300 leading-7 text-justify text-sm md:text-base">
                        <!-- Long description injected here -->
                    </p>
                </div>

                <!-- TAB 3: REFERENCES -->
                <div id="content-refs" class="hidden space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-800/50 p-4 rounded border border-gray-700">
                            <h3 class="text-purple-400 font-bold mb-3 uppercase text-sm">üß† Th√©oriciens Cl√©s</h3>
                            <ul id="modal-theorists" class="space-y-2 text-sm text-gray-300"></ul>
                        </div>
                        <div class="bg-gray-800/50 p-4 rounded border border-gray-700">
                            <h3 class="text-green-400 font-bold mb-3 uppercase text-sm">üìö Livre √† lire</h3>
                            <ul id="modal-books" class="space-y-2 text-sm text-gray-300"></ul>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- GAME DATA ---
        const SECRET_CODE = "TINKER25";
        
        const i18n = {
            fr: {
                subtitle: "Quizz des M√©thodologies",
                introText: "Affrontez le Boss de l'Ignorance ! Prouvez votre expertise sur 8 m√©thodologies actives. 3 erreurs et c'est la mort.",
                startBtn: "COMMENCER",
                haveCode: "Vous avez un code ?",
                bossName: "L'IGNORANCE",
                unlockMsg: "Acc√®s autoris√© aux Archives S√©cr√®tes.",
                saveCode: "NOTEZ CE CODE :",
                bonusTitle: "M√âTHODOLOGIES BONUS",
                correct: "EXCELLENT ! D√âG√ÇTS CRITIQUES !",
                wrong: "ERREUR ! VOUS PERDEZ DES PV !",
                gameOverTitle: "GAME OVER",
                endGameLose: "L'Ignorance l'emporte..."
            },
            en: {
                subtitle: "Learning Methodologies Quiz",
                introText: "Face the Boss of Ignorance! Prove your expertise on 8 active methodologies. 3 strikes and you are out.",
                startBtn: "START GAME",
                haveCode: "Have a code?",
                bossName: "IGNORANCE",
                unlockMsg: "Access granted to Secret Archives.",
                saveCode: "SAVE THIS CODE:",
                bonusTitle: "BONUS METHODOLOGIES",
                correct: "EXCELLENT! CRITICAL HIT!",
                wrong: "WRONG! DAMAGE TAKEN!",
                gameOverTitle: "GAME OVER",
                endGameLose: "Ignorance prevails..."
            },
            mg: {
                subtitle: "Fanadinana Fomba Fampianarana",
                introText: "Miady amin'ny Lehiben'ny Tsy Fahalalana! Asehoy ny fahaizanao. Fahadisoana 3 dia resy ianao.",
                startBtn: "MANOMBOKA",
                haveCode: "Manana kaody ve ianao?",
                bossName: "TSY FAHALALANA",
                unlockMsg: "Nahazo alalana hiditra amin'ny Tahiry Miafina.",
                saveCode: "RAIKETIO ITY KAODY ITY:",
                bonusTitle: "FOMBA FAMPIANARANA FANAMPINY",
                correct: "TENA TSARA ! VOA NY LEHIBE !",
                wrong: "DISO ! VOA IANAO !",
                gameOverTitle: "RESY IANAO",
                endGameLose: "Nandresy ny Tsy Fahalalana..."
            }
        };

        // --- ENRICHED QUESTIONS DATA ---
        const questionsData = {
            fr: [
                { category: "Apprentissage par Projet (PBL)", text: "En PBL, quelle affirmation est vraie concernant le r√¥le de l'enseignant ?", answers: [{text: "Il est le seul d√©tenteur du savoir", correct: false}, {text: "Il agit comme facilitateur et guide", correct: true}, {text: "Il ne doit jamais intervenir", correct: false}] },
                { category: "Apprentissage par les Pairs", text: "Quelle est la dynamique cl√© du 'Peer Learning' ?", answers: [{text: "Comp√©tition individuelle stricte", correct: false}, {text: "Coop√©ration sym√©trique entre √©gaux", correct: true}, {text: "Relation Ma√Ætre-Disciple verticale", correct: false}] },
                { category: "Apprentissage par le Jeu (GBL)", text: "Quelle est la diff√©rence fondamentale entre Gamification et GBL ?", answers: [{text: "Aucune, ce sont des synonymes", correct: false}, {text: "La Gamification utilise des √©l√©ments de jeu ; le GBL est un jeu entier √©ducatif", correct: true}, {text: "Le GBL n'utilise pas le num√©rique", correct: false}] },
                { category: "Apprentissage par Probl√®me", text: "Dans l'Apprentissage par Probl√®me, le point de d√©part est :", answers: [{text: "Un probl√®me complexe, ouvert et mal structur√©", correct: true}, {text: "Un cours th√©orique complet", correct: false}, {text: "La m√©morisation de formules", correct: false}] },
                { category: "Apprentissage par le D√©fi (CBL)", text: "Le CBL se distingue du PBL par son focus sur...", answers: [{text: "Des probl√®mes fictifs pour s'entra√Æner", correct: false}, {text: "Des d√©fis mondiaux r√©els menant √† une action locale concr√®te", correct: true}, {text: "La rapidit√© d'ex√©cution", correct: false}] },
                { category: "Apprentissage par le Jeu (GBL)", text: "Pour qu'un jeu soit p√©dagogique (GBL), il doit √©quilibrer :", answers: [{text: "Le graphisme et le son", correct: false}, {text: "Le 'Gameplay' (plaisir) et le contenu √©ducatif", correct: true}, {text: "La difficult√© et la facilit√©", correct: false}] },
                { category: "Apprentissage Ancr√© (Lieu)", text: "Le 'Place Based Learning' utilise comme ressource principale :", answers: [{text: "Le manuel scolaire officiel", correct: false}, {text: "Le contexte local, l'histoire et l'environnement physique imm√©diat", correct: true}, {text: "Des vid√©os YouTube", correct: false}] },
                { category: "Apprentissage par D√©bat", text: "Au-del√† de la rh√©torique, que d√©veloppe principalement le d√©bat ?", answers: [{text: "L'agressivit√© verbale", correct: false}, {text: "L'empathie cognitive (comprendre le point de vue adverse)", correct: true}, {text: "La capacit√© √† parler fort", correct: false}] },
                { category: "Apprentissage par Projet (PBL)", text: "Le 'produit final' en PBL doit id√©alement √™tre :", answers: [{text: "Pr√©sent√© √† un public r√©el au-del√† de la classe", correct: true}, {text: "Jet√© √† la poubelle apr√®s notation", correct: false}, {text: "Un simple QCM", correct: false}] },
                { category: "P√©dagogie Bootcamp", text: "La p√©dagogie Bootcamp repose sur le concept de :", answers: [{text: "L'immersion totale et la pratique intensive sur courte dur√©e", correct: true}, {text: "L'apprentissage dilu√© sur plusieurs ann√©es", correct: false}, {text: "La th√©orie pure sans pratique", correct: false}] },
                { category: "Apprentissage par les Pairs", text: "L'effet 'Prot√©g√©' en p√©dagogie sugg√®re que :", answers: [{text: "Enseigner aux autres est la meilleure fa√ßon d'apprendre soi-m√™me", correct: true}, {text: "Les √©l√®ves doivent √™tre prot√©g√©s de l'√©chec", correct: false}, {text: "Le professeur doit prot√©ger les √©l√®ves", correct: false}] },
                { category: "M√©thodologies Mixtes", text: "Qu'est-ce que le 'Blended Learning' ?", answers: [{text: "Un m√©lange de jus de fruits", correct: false}, {text: "L'hybridation entre pr√©sentiel et distanciel/num√©rique", correct: true}, {text: "L'utilisation exclusive de tablettes", correct: false}] }
            ],
            mg: [
                { category: "Fianarana Mifototra amin'ny Tetikasa", text: "Inona no tena anjara asan'ny mpampianatra amin'ny PBL?", answers: [{text: "Izy irery no manana ny fahalalana", correct: false}, {text: "Mpanamora sy mpitari-dalana (Facilitator)", correct: true}, {text: "Tsy tokony hiditra an-tsehatra mihitsy", correct: false}] },
                { category: "Fianarana Miaraka amin'ny Namana", text: "Inona no fototry ny 'Peer Learning'?", answers: [{text: "Fifaninanana mahery vaika", correct: false}, {text: "Fifanampiana mitovy lenta eo amin'ny samy mpianatra", correct: true}, {text: "Fifandraisana ambony-ambany (Mpampianatra-Mpianatra)", correct: false}] },
                { category: "Fianarana Amin'ny Alalan'ny Lalao", text: "Inona no maha-samy hafa ny Gamification sy ny GBL?", answers: [{text: "Tsy misy, mitovy ihany", correct: false}, {text: "Gamification = singa lalao (isa/badge) ; GBL = lalao feno", correct: true}, {text: "Tsy mampiasa ordinatera ny GBL", correct: false}] },
                { category: "Fianarana Mifototra amin'ny Olana", text: "Ahoana no manomboka ny 'Problem Based Learning'?", answers: [{text: "Olana sarotra, misokatra ary tsy manana valiny tokana", correct: true}, {text: "Lesona feno avy amin'ny boky", correct: false}, {text: "Fitadidiana raikipohy", correct: false}] },
                { category: "Fianarana Mifototra amin'ny Fanamby", text: "Inona no mampiavaka ny CBL amin'ny PBL?", answers: [{text: "Olana noforonina ao an-dakilasy", correct: false}, {text: "Fanamby eran-tany mitarika hetsika tena izy", correct: true}, {text: "Fahavitrihana", correct: false}] },
                { category: "Fianarana Amin'ny Alalan'ny Lalao", text: "Mba haha-fampianarana ny lalao iray, inona no tsy maintsy atambatra?", answers: [{text: "Ny sary sy ny feo", correct: false}, {text: "Ny fahafinaretana (Gameplay) sy ny fianarana", correct: true}, {text: "Ny hamora sy ny hasarotra", correct: false}] },
                { category: "Fianarana Mifototra amin'ny Toerana", text: "Inona no ampiasaina voalohany amin'ny 'Place Based Learning'?", answers: [{text: "Boky fianarana", correct: false}, {text: "Ny tontolo iainana, ny tantara ary ny fiaraha-monina eo an-toerana", correct: true}, {text: "Horonantsary Video", correct: false}] },
                { category: "Fianarana Amin'ny Alalan'ny Adihevitra", text: "Ankoatra ny fahaizana miteny, inona no tena kolokoloina amin'ny adihevitra?", answers: [{text: "Ny hatezerana", correct: false}, {text: "Ny fahatakarana ny hevitry ny hafa (Empathie)", correct: true}, {text: "Ny fitenenana mafy", correct: false}] },
                { category: "Fianarana Mifototra amin'ny Tetikasa", text: "Ny 'Vokatra Farany' amin'ny PBL dia tokony:", answers: [{text: "Aseho amin'ny olona ivelan'ny sekoly (Public Audience)", correct: true}, {text: "Ariana rehefa azo ny naoty", correct: false}, {text: "Fanadinana an-taratasy tsotra", correct: false}] },
                { category: "Fiofanana Intsitraka (Bootcamp)", text: "Ny fomba fampianarana Bootcamp dia mifototra amin'ny:", answers: [{text: "Fianarana lalina sy fampiharana mafy ao anatin'ny fotoana fohy", correct: true}, {text: "Fianarana miadana mandritra ny taona maro", correct: false}, {text: "Teoria fotsiny", correct: false}] },
                { category: "Fianarana Miaraka amin'ny Namana", text: "Ny 'Prot√©g√© Effect' dia milaza fa:", answers: [{text: "Ny mampianatra ny hafa no fomba tsara indrindra hianarana", correct: true}, {text: "Tokony harovana ny mpianatra", correct: false}, {text: "Ny mpampianatra no tompon'ny teny farany", correct: false}] },
                { category: "Fomba Fampianarana Mifangaro", text: "Inona no atao hoe 'Blended Learning'?", answers: [{text: "Fangaroana ranom-boankazo", correct: false}, {text: "Fampifangaroana ny fianarana an-dakilasy sy ny teknolojia (an-tranonkala)", correct: true}, {text: "Fampiasana Tablette ihany", correct: false}] }
            ],
            // English kept concise for brevity but structured same way
            en: [
                { category: "Project Based Learning", text: "In PBL, what is the teacher's primary role?", answers: [{text: "Sole source of knowledge", correct: false}, {text: "Facilitator and guide", correct: true}, {text: "Passive observer", correct: false}] },
                { category: "Peer Based Learning", text: "What is the key dynamic of Peer Learning?", answers: [{text: "Strict competition", correct: false}, {text: "Symmetrical cooperation among equals", correct: true}, {text: "Master-Disciple relationship", correct: false}] },
                { category: "Game Based Learning", text: "Key difference between Gamification and GBL?", answers: [{text: "They are synonyms", correct: false}, {text: "Gamification = game elements; GBL = full game", correct: true}, {text: "GBL is analog only", correct: false}] },
                { category: "Problem Based Learning", text: "PBL starts with...", answers: [{text: "An ill-structured, open-ended problem", correct: true}, {text: "A lecture", correct: false}, {text: "Memorization", correct: false}] },
                { category: "Challenge Based Learning", text: "CBL focuses on...", answers: [{text: "Fictional drills", correct: false}, {text: "Global challenges leading to local action", correct: true}, {text: "Speed", correct: false}] },
                { category: "Game Based Learning", text: "To be educational, a game must balance:", answers: [{text: "Graphics and Sound", correct: false}, {text: "Gameplay (Fun) and Learning Content", correct: true}, {text: "Easy and Hard modes", correct: false}] },
                { category: "Place Based Learning", text: "Place Based Learning primarily uses:", answers: [{text: "Textbooks", correct: false}, {text: "Local context, history, and physical environment", correct: true}, {text: "Videos", correct: false}] },
                { category: "Debate Based Learning", text: "Debating primarily develops:", answers: [{text: "Aggression", correct: false}, {text: "Cognitive empathy (understanding opposing views)", correct: true}, {text: "Volume of voice", correct: false}] },
                { category: "Project Based Learning", text: "The 'Final Product' in PBL should ideally be:", answers: [{text: "Presented to a real public audience", correct: true}, {text: "Discarded after grading", correct: false}, {text: "A simple quiz", correct: false}] },
                { category: "Bootcamp Learning", text: "Bootcamp pedagogy is based on:", answers: [{text: "Total immersion and high intensity practice", correct: true}, {text: "Slow learning over years", correct: false}, {text: "Pure theory", correct: false}] },
                { category: "Peer Based Learning", text: "The 'Prot√©g√© Effect' suggests:", answers: [{text: "Teaching others is the best way to learn", correct: true}, {text: "Students need protection", correct: false}, {text: "Teachers know best", correct: false}] },
                { category: "Mixed Methodologies", text: "What is 'Blended Learning'?", answers: [{text: "Mixing drinks", correct: false}, {text: "Hybrid of face-to-face and online learning", correct: true}, {text: "Tablet only learning", correct: false}] }
            ]
        };

        // --- ENRICHED BONUS DATA (DEEP LEARNING) ---
        const bonusesData = {
            fr: [
                { 
                    title: "Adventure Based Learning", 
                    concept: "Utilisation d'activit√©s structur√©es (souvent physiques ou en ext√©rieur) comportant un risque per√ßu (mais g√©r√©) pour favoriser le d√©veloppement personnel.", 
                    description: "L'Adventure Based Learning (ABL) ne se limite pas √† faire du sport. C'est une s√©quenciation p√©dagogique pr√©cise qui utilise le 'd√©s√©quilibre' psychologique provoqu√© par une situation nouvelle ou risqu√©e pour forcer l'adaptation. On sort de la zone de confort pour entrer dans la zone d'apprentissage. Le c≈ìur de la m√©thode est le 'D√©briefing' : sans r√©flexion guid√©e apr√®s l'action, l'exp√©rience n'est qu'un divertissement.",
                    tips: ["Commencez par des 'Ice Breakers' simples.", "Le d√©briefing (m√©tacognition) est plus important que l'activit√© elle-m√™me.", "Challenge by Choice : ne jamais forcer la participation physique."], 
                    theorists: ["Colin Mortlock (The Adventure Alternative)", "Kurt Hahn (Fondateur Outward Bound)"],
                    books: ["'Adventure in the Curriculum' - Prouty", "'Processing the Experience' - Luckner & Nadler"]
                },
                { 
                    title: "Digital Storytelling", 
                    concept: "Combiner la narration traditionnelle avec des outils num√©riques (images, sons, vid√©os) pour cr√©er de courtes histoires engageantes.", 
                    description: "Le Digital Storytelling permet de donner une voix aux apprenants. Il ne s'agit pas d'apprendre √† utiliser un logiciel de montage, mais d'apprendre √† structurer sa pens√©e, √† synth√©tiser une id√©e complexe en une narration √©motionnelle courte. C'est un outil puissant pour l'introspection et la communication.",
                    tips: ["Le script d'abord, la tech ensuite (Story Circle).", "Format court impos√© (2-3 min max).", "C'est la voix de l'√©l√®ve qui doit porter l'histoire."], 
                    theorists: ["Joe Lambert (Center for Digital Storytelling)", "Dana Atchley"],
                    books: ["'Digital Storytelling: Capturing Lives' - Joe Lambert", "'The New Digital Storytelling' - Bryan Alexander"]
                },
                { 
                    title: "Learning by Tinkering", 
                    concept: "Apprendre en 'bidouillant'. Approche pratique o√π l'on d√©monte, r√©pare ou construit pour comprendre le fonctionnement.", 
                    description: "Issu du constructionnisme, le Tinkering (bricolage intelligent) valorise le processus plus que le produit. Contrairement √† un projet √©tape par √©tape, le Tinkering est exploratoire. L'erreur n'est pas une faute, c'est une donn√©e ('Bug') qui informe sur le syst√®me. C'est la base de la culture Maker et FabLab.",
                    tips: ["L'√©chec est une donn√©e, pas une fin.", "Fournir des mat√©riaux riches mais pas de mode d'emploi.", "Documenter le processus (Portfolio)."], 
                    theorists: ["Seymour Papert (Constructionnisme)", "Mitchel Resnick (MIT Media Lab)"],
                    books: ["'Mindstorms' - Seymour Papert", "'Invent to Learn' - Sylvia Libow Martinez"]
                },
                { 
                    title: "Open Space Technology", 
                    concept: "M√©thode pour organiser des r√©unions ou des cours o√π les participants cr√©ent eux-m√™mes l'ordre du jour sur place.", 
                    description: "L'OST part du principe que les pauses caf√© sont souvent plus productives que les r√©unions formelles. On supprime l'agenda pr√©√©tabli. Les participants passionn√©s par un sujet proposent une session. C'est l'auto-organisation radicale qui maximise l'engagement et la responsabilit√©.",
                    tips: ["Loi des deux pieds : si tu n'apprends rien, bouge.", "Les personnes qui viennent sont les bonnes personnes.", "√áa commence quand √ßa commence."], 
                    theorists: ["Harrison Owen (Cr√©ateur de l'OST)"],
                    books: ["'Open Space Technology: A User's Guide' - Harrison Owen", "'The Practice of Peace' - Harrison Owen"]
                }
            ],
            mg: [
                { 
                    title: "Adventure Based Learning", 
                    concept: "Fampiasana hetsika (matetika any ivelany) misy risika voafehy mba hampitomboana ny fahaizana miaina sy miaraka.", 
                    description: "Ny ABL dia tsy fanatanjahantena fotsiny. Fomba fampianarana mampiasa ny zava-baovao na sarotra mba hanosehana ny mpianatra hivoatra. Ny tena zava-dehibe dia ny 'Famakafakana' (Debriefing) aorian'ny hetsika. Raha tsy misy io, dia kilalao fotsiny ilay izy fa tsy fianarana.",
                    tips: ["Atomboka amin'ny lalao tsotra.", "Ny famakafakana no tena lesona.", "Safidy ny fandraisana anjara (Tsy terena)."], 
                    theorists: ["Colin Mortlock", "Kurt Hahn"],
                    books: ["'Adventure in the Curriculum'", "'Processing the Experience'"]
                },
                { 
                    title: "Digital Storytelling", 
                    concept: "Fampifangaroana ny fitantarana sy ny teknolojia (sary, feo) hamoronana tantara fohy misy fihetseham-po.", 
                    description: "Ny Digital Storytelling dia fomba hanehoan'ny mpianatra ny heviny. Tsy fianarana informatika ity, fa fianarana mandrafitra hevitra sy mitantara izany amin'ny fomba manohina ny fo. Fitaovana tsara ho an'ny fifandraisana sy ny fahalalana ny tena.",
                    tips: ["Soratra aloha vao teknolojia.", "Ataovy fohy (2-3 min).", "Ny feon'ny mpianatra no ampiasaina."], 
                    theorists: ["Joe Lambert", "Dana Atchley"],
                    books: ["'Digital Storytelling' - Joe Lambert", "'The New Digital Storytelling'"]
                },
                { 
                    title: "Learning by Tinkering", 
                    concept: "Mianatra amin'ny alalan'ny fanamboarana sy fandravana zavatra. Tsy matahotra manao diso.", 
                    description: "Avy amin'ny Constructionism, ny Tinkering dia manome lanja ny fikarohana. Tsy manaraka torolalana (notice) ny mpianatra fa manandrana. Ny fahadisoana dia tsy ratsy, fa fomba ahazoana fahalalana vaovao. Io no fototry ny 'Maker Movement'.",
                    tips: ["Ny tsy fahombiazana dia fianarana.", "Fitaovana maro fa tsy misy torolalana.", "Raketo an-tsoratra ny dingana."], 
                    theorists: ["Seymour Papert", "Mitchel Resnick"],
                    books: ["'Mindstorms' - Papert", "'Invent to Learn'"]
                },
                { 
                    title: "Open Space Technology", 
                    concept: "Fomba fivoriana izay ny mpandray anjara ihany no mamorona ny fandaharam-potoana eo noho eo.", 
                    description: "Ny OST dia mihevitra fa ny resaka an-tsehatra (pause caf√©) matetika no mahomby kokoa noho ny fivoriana ofisialy. Tsy misy fandaharam-potoana mialoha. Izay liana amin'ny lohahevitra iray no mitarika. Fomba fiasa manome andraikitra feno ny mpandray anjara.",
                    tips: ["Lal√†n'ny tongotra roa: raha tsy mianatra ianao dia mifindr√†.", "Izay tonga eo no olona mety.", "Manomboka izy rehefa vonona."], 
                    theorists: ["Harrison Owen"],
                    books: ["'Open Space Technology' - Harrison Owen", "'The Practice of Peace'"]
                }
            ],
            // English Data filled for consistency
            en: [
                { 
                    title: "Adventure Based Learning", 
                    concept: "Structured outdoor activities with perceived risk for growth.", 
                    description: "ABL uses the psychological disequilibrium caused by risk to force adaptation. It forces students out of their comfort zone. The core is the 'Debriefing': without guided reflection, the experience is just recreation.",
                    tips: ["Start with Ice Breakers.", "Debriefing is key.", "Challenge by Choice."], 
                    theorists: ["Colin Mortlock", "Kurt Hahn"],
                    books: ["'Adventure in the Curriculum'", "'Processing the Experience'"]
                },
                { 
                    title: "Digital Storytelling", 
                    concept: "Mixing traditional narrative with digital tools.", 
                    description: "Digital Storytelling gives students a voice. It is not about video editing skills, but about structuring thoughts and synthesizing complex ideas into a short narrative.",
                    tips: ["Script first.", "Keep it short.", "Student's voice."], 
                    theorists: ["Joe Lambert", "Dana Atchley"],
                    books: ["'Digital Storytelling' - Joe Lambert", "'The New Digital Storytelling'"]
                },
                { 
                    title: "Learning by Tinkering", 
                    concept: "Learning by making/breaking. Hands-on exploration.", 
                    description: "Rooted in constructionism, Tinkering values the process over the product. Failure is not a mistake, it's data (a 'Bug'). This is the foundation of the Maker culture.",
                    tips: ["Failure is data.", "Low tech first.", "Document process."], 
                    theorists: ["Seymour Papert", "Mitchel Resnick"],
                    books: ["'Mindstorms' - Papert", "'Invent to Learn'"]
                },
                { 
                    title: "Open Space Technology", 
                    concept: "Participant-driven agenda meeting format.", 
                    description: "OST assumes coffee breaks are often more productive than formal meetings. No pre-set agenda. Passionate participants propose sessions. Radical self-organization.",
                    tips: ["Law of Two Feet.", "Self-organization.", "Starts when it starts."], 
                    theorists: ["Harrison Owen"],
                    books: ["'Open Space Technology' - Owen", "'The Practice of Peace'"]
                }
            ]
        };

        // --- STATE ---
        let currentLang = 'fr';
        let playerHP = 100;
        let bossHP = 100;
        let currentQIndex = 0;
        let gameActive = false;
        let questions = [];

        // --- CORE FUNCTIONS ---

        function setLanguage(lang) {
            currentLang = lang;
            ['fr', 'en', 'mg'].forEach(l => {
                document.getElementById(`btn-${l}`).classList.toggle('opacity-50', l !== lang);
                document.getElementById(`btn-${l}`).classList.toggle('border-transparent', l !== lang);
            });
            
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (i18n[lang][key]) el.textContent = i18n[lang][key];
            });

            if (!document.getElementById('victory-screen').classList.contains('hidden')) {
                 renderBonusCards();
            }
        }

        function checkCode() {
            const input = document.getElementById('secret-code-input').value.toUpperCase().trim();
            const err = document.getElementById('code-error');
            
            if (input === SECRET_CODE) {
                showVictory();
            } else {
                err.style.opacity = '1';
                setTimeout(() => err.style.opacity = '0', 2000);
            }
        }

        function startGame() {
            gameActive = true;
            playerHP = 100;
            bossHP = 100;
            currentQIndex = 0;
            updateBars();

            // Load language specific questions & Clone properly
            questions = JSON.parse(JSON.stringify(questionsData[currentLang]));
            
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('flex');
            document.getElementById('defeat-screen').classList.add('hidden'); // Ensure defeat screen is hidden
            
            loadQuestion();
        }

        function updateBars() {
            const pBar = document.getElementById('player-hp-bar');
            const bBar = document.getElementById('boss-hp-bar');
            
            pBar.style.width = playerHP + '%';
            document.getElementById('player-hp-text').innerText = Math.round(playerHP) + '/100';
            
            bBar.style.width = bossHP + '%';
            document.getElementById('boss-hp-text').innerText = bossHP + '/100';

            pBar.className = `health-bar-fill w-full ${playerHP < 34 ? 'bg-red-500 shadow-[0_0_10px_#ef4444]' : 'bg-blue-500 shadow-[0_0_10px_#3b82f6]'}`;
        }

        function loadQuestion() {
            if (currentQIndex >= questions.length) {
                showVictory();
                return;
            }

            const q = questions[currentQIndex];
            document.getElementById('question-category').innerText = q.category;
            document.getElementById('question-counter').innerText = `Q: ${currentQIndex + 1}/${questions.length}`;
            
            const feedback = document.getElementById('feedback-area');
            feedback.style.opacity = '0';

            // Reset containers
            const stdContainer = document.getElementById('answers-container');
            stdContainer.innerHTML = '';
            
            document.getElementById('question-text').innerText = q.text;

            // Shuffle answers
            const answers = [...q.answers].sort(() => Math.random() - 0.5);

            answers.forEach(ans => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-lg bg-gray-800/80 hover:bg-gray-700 border border-gray-600 hover:border-blue-400 transition-all text-sm md:text-base font-medium relative overflow-hidden group";
                btn.innerHTML = `<span class="relative z-10">${ans.text}</span><div class="absolute inset-0 bg-blue-600/20 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>`;
                btn.onclick = () => handleChoiceAnswer(ans.correct, btn);
                stdContainer.appendChild(btn);
            });
        }

        // --- CHOICE LOGIC ---
        function handleChoiceAnswer(isCorrect, btnElement) {
            const btns = document.querySelectorAll('#answers-container button');
            btns.forEach(b => b.disabled = true);

            if (isCorrect) {
                bossHP = Math.max(0, bossHP - 9); 
                btnElement.classList.replace('border-gray-600', 'border-green-400');
                btnElement.classList.add('bg-green-600/20');
                showFeedback(true, i18n[currentLang].correct);
                document.getElementById('boss-visual').classList.add('shake-element');
            } else {
                playerHP = Math.max(0, playerHP - 34); 
                btnElement.classList.replace('border-gray-600', 'border-red-400');
                btnElement.classList.add('bg-red-600/20');
                showFeedback(false, i18n[currentLang].wrong);
                document.body.classList.add('shake-element');
            }
            
            setTimeout(() => {
                document.getElementById('boss-visual').classList.remove('shake-element');
                document.body.classList.remove('shake-element');
            }, 500);

            updateBars();

            if (playerHP <= 0) {
                 setTimeout(showDefeat, 1000);
            } else if (bossHP <= 0) { 
                 setTimeout(showVictory, 1000);
            } else {
                currentQIndex++;
                setTimeout(loadQuestion, 1500);
            }
        }

        function showFeedback(isGood, text) {
            const fb = document.getElementById('feedback-area');
            fb.innerText = text;
            fb.style.color = isGood ? '#4ade80' : '#ef4444';
            fb.style.opacity = '1';
        }

        function showVictory() {
            gameActive = false;
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('flex');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('victory-screen').classList.remove('hidden');
            renderBonusCards();
        }

        function showDefeat() {
            gameActive = false;
            document.getElementById('game-screen').classList.remove('flex');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('defeat-screen').classList.remove('hidden');
        }

        function renderBonusCards() {
            const grid = document.getElementById('bonus-grid');
            grid.innerHTML = '';
            
            const bonuses = bonusesData[currentLang];
            const colors = ['green', 'blue', 'yellow', 'purple'];
            
            bonuses.forEach((b, idx) => {
                const color = colors[idx % colors.length];
                const card = document.createElement('div');
                card.className = `glass-panel p-5 rounded-xl card-hover cursor-pointer border-l-4 border-${color}-400 flex flex-col justify-between h-32 md:h-40`;
                card.onclick = () => openModal(idx);
                card.innerHTML = `
                    <h4 class="text-lg md:text-xl font-bold leading-tight">${b.title}</h4>
                    <div class="flex justify-between items-end mt-2">
                        <span class="text-[10px] uppercase tracking-widest text-gray-400">Tap for details</span>
                        <div class="w-8 h-8 rounded-full bg-${color}-500/20 flex items-center justify-center text-${color}-400">
                            ‚ûú
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- ENRICHED MODAL LOGIC ---
        let currentModalData = null;

        function openModal(index) {
            const data = bonusesData[currentLang][index];
            currentModalData = data;
            const overlay = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            
            document.getElementById('modal-title').innerText = data.title;
            
            // Render default tab (Concept)
            renderTabContent('concept');
            
            overlay.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function switchTab(tabName) {
            // Update Buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // Hide all content areas
            document.getElementById('content-concept').classList.add('hidden');
            document.getElementById('content-details').classList.add('hidden');
            document.getElementById('content-refs').classList.add('hidden');

            // Show selected
            document.getElementById(`content-${tabName}`).classList.remove('hidden');

            renderTabContent(tabName);
        }

        function renderTabContent(tabName) {
            const data = currentModalData;
            if (!data) return;

            if (tabName === 'concept') {
                document.getElementById('modal-concept').innerText = data.concept;
                const tipsList = document.getElementById('modal-tips');
                tipsList.innerHTML = '';
                data.tips.forEach(tip => {
                    tipsList.innerHTML += `<li class="flex items-start gap-2"><span class="text-yellow-500 mt-1">‚ñπ</span><span>${tip}</span></li>`;
                });
            } else if (tabName === 'details') {
                document.getElementById('modal-description').innerText = data.description;
            } else if (tabName === 'refs') {
                const theoriesList = document.getElementById('modal-theorists');
                theoriesList.innerHTML = '';
                data.theorists.forEach(t => {
                    theoriesList.innerHTML += `<li>${t}</li>`;
                });

                const booksList = document.getElementById('modal-books');
                booksList.innerHTML = '';
                data.books.forEach(b => {
                    booksList.innerHTML += `<li>${b}</li>`;
                });
            }
        }

        function closeModal() {
            const overlay = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                overlay.classList.add('hidden');
                // Reset tab to concept for next time
                switchTab('concept');
            }, 300);
        }

        // Init
        setLanguage('fr');

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vi-Act - Agenda Interactif V3</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Police Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Style pour la ligne de temps actuelle */
        .now-indicator-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #ef4444; /* red-500 */
            z-index: 10;
            pointer-events: none;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .now-indicator-line::before {
            content: '';
            position: absolute;
            left: -4px;
            top: -3px;
            width: 8px;
            height: 8px;
            background-color: #ef4444;
            border-radius: 50%;
        }
        .now-indicator-line::after {
            content: 'MAINTENANT';
            position: absolute;
            right: 0;
            top: -18px;
            background-color: #ef4444;
            color: white;
            font-size: 9px;
            font-weight: bold;
            padding: 1px 4px;
            border-radius: 2px;
            opacity: 0.9;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 p-2 md:p-4 min-h-screen">

    <div id="app" class="max-w-[1400px] mx-auto">
        <!-- Contenu g√©n√©r√© par JS -->
    </div>

    <script>
        // --- DONN√âES & CONFIGURATION ---

        const timezones = [
            { id: 'fr', name: 'France (Paris) / Belgique', offset: 0, flag: 'üá´üá∑' },
            { id: 'ro', name: 'Roumanie / Bulgarie', offset: 1, flag: 'üá∑üá¥' },
            { id: 'mg', name: 'Madagascar', offset: 2, flag: 'üá≤üá¨' },
            { id: 'sc', name: 'Seychelles / Maurice', offset: 3, flag: 'üá∏üá®' },
        ];

        const translations = {
            fr: {
                title: "Vi-Act - Virtual youth work",
                subtitle: "Agenda de Formation",
                view_week: "Vue Semaine",
                view_day: "Vue Journ√©e",
                legend_synchrone: "Synchrone (Live)",
                legend_elearning: "E-learning",
                legend_blended: "Blended",
                legend_opening: "Ouverture",
                legend_social: "Social Club",
                opening: "Ouverture salle virtuelle",
                break_label: "Pause",
                days: ["Jour 1", "Jour 2", "Jour 3", "Jour 4", "Jour 5", "Jour 6"],
                day_themes: [
                    "Introduction au travail de jeunesse num√©rique et aux r√©alit√©s des jeunes",
                    "Accompagner les initiatives de jeunes",
                    "Construire un √©cosyst√®me local de travail jeunesse",
                    "Conception d'animations",
                    "Animation de groupe et d'activit√©s",
                    "Evaluer, communiquer et maximiser l'impact des nos actions"
                ],
                social_club_title: "Social Club",
                social_club_parallel: "Ouvert en parall√®le de cette session",
                time_label: "Heure",
                note: "* Horaires ajust√©s au fuseau s√©lectionn√© (Base: 07:30 FR)",
                next_day: "Jour Suivant",
                prev_day: "Jour Pr√©c√©dent",
                current_time: "Heure actuelle : ",
                now_badge: "EN COURS"
            },
            en: {
                title: "Vi-Act - Virtual youth work",
                subtitle: "Training Schedule",
                view_week: "Week View",
                view_day: "Day View",
                legend_synchrone: "Synchronous (Live)",
                legend_elearning: "E-learning",
                legend_blended: "Blended",
                legend_opening: "Opening",
                legend_social: "Social Club",
                opening: "Virtual Room Opening",
                break_label: "Break",
                days: ["Day 1", "Day 2", "Day 3", "Day 4", "Day 5", "Day 6"],
                day_themes: [
                    "Introduction to Digital Youth Work and Youth Realities",
                    "Supporting Youth Initiatives",
                    "Building a Local Youth Work Ecosystem",
                    "Designing Animations",
                    "Group Facilitation and Activities",
                    "Evaluating, Communicating, and Maximizing Impact"
                ],
                social_club_title: "Social Club",
                social_club_parallel: "Open in parallel to this session",
                time_label: "Time",
                note: "* Times adjusted to selected timezone (Base: 07:30 FR)",
                next_day: "Next Day",
                prev_day: "Previous Day",
                current_time: "Current Time: ",
                now_badge: "NOW"
            }
        };

        const scheduleData = [
            // --- JOUR 1 ---
            { day: 0, start: 7.5, duration: 30, type: 'opening', titleFr: "Ouverture salle virtuelle", titleEn: "Virtual Room Opening" },
            { day: 0, start: 8.0, duration: 120, type: 'synchrone', titleFr: "1. Ouverture de la formation", titleEn: "1. Opening of the Training" },
            { day: 0, start: 10.0, duration: 30, type: 'break', titleFr: "Pause", titleEn: "Break" },
            { day: 0, start: 10.5, duration: 120, type: 'synchrone', titleFr: "2. Animateur/travailleur jeunesse digital, c'est quoi?", titleEn: "2. Digital Youth Worker: What is it?" },
            { day: 0, start: 12.5, duration: 60, type: 'break', titleFr: "Pause", titleEn: "Break" },
            { day: 0, start: 13.5, duration: 90, type: 'blended', titleFr: "3. Les r√©alit√©s des jeunes - Partie 1: Analyse de besoins & entretiens", titleEn: "3. Youth Realities - Part 1: Needs Analysis & Empathy Interviews" },
            { day: 0, start: 15.0, duration: 30, type: 'opening', titleFr: "Reflection Time", titleEn: "Reflection Time" },
            { day: 0, start: 15.5, duration: 120, type: 'elearning', titleFr: "3 bis. Les r√©alit√©s des jeunes - Partie 2: Recherche & r√©colte", titleEn: "3 bis. Youth Realities - Part 2: Research & Gathering Info" },

            // --- JOUR 2 ---
            { day: 1, start: 7.5, duration: 30, type: 'opening', titleFr: "Ouverture salle virtuelle", titleEn: "Virtual Room Opening" },
            { day: 1, start: 8.0, duration: 120, type: 'synchrone', titleFr: "4. Accompagner les processus cr√©atifs des jeunes (M√©thodologie)", titleEn: "4. Supporting Youth Creative Processes (Methodology)" },
            { day: 1, start: 10.0, duration: 30, type: 'break', titleFr: "Pause", titleEn: "Break" },
            { day: 1, start: 10.5, duration: 120, type: 'blended', titleFr: "5. Encourager et coordonner la vie b√©n√©vole", titleEn: "5. Encouraging & Coordinating Volunteering" },
            { day: 1, start: 12.5, duration: 60, type: 'opening', titleFr: "Reflection Time", titleEn: "Reflection Time" },
            { day: 1, start: 13.5, duration: 120, type: 'elearning', titleFr: "6. M√©thodologies d'apprentissage actifs & andragogie", titleEn: "6. Active Learning Methodologies & Andragogy" },
            { day: 1, start: 15.5, duration: 120, type: 'elearning', titleFr: "7. M√©thodologies d'accompagnement - bonnes pratiques & tutorat", titleEn: "7. Support Methodologies - Best Practices & Tutoring" },

            // --- JOUR 3 ---
            { day: 2, start: 7.5, duration: 30, type: 'opening', titleFr: "Ouverture salle virtuelle", titleEn: "Virtual Room Opening" },
            { day: 2, start: 8.0, duration: 120, type: 'synchrone', titleFr: "8. Cartographier les partenaires & coalition d‚Äôapprentissage", titleEn: "8. Mapping Partners & Learning Coalitions" },
            { day: 2, start: 10.0, duration: 30, type: 'break', titleFr: "Pause", titleEn: "Break" },
            { day: 2, start: 10.5, duration: 120, type: 'synchrone', titleFr: "9. Cr√©er un espace participatif & interculturel", titleEn: "9. Creating Participatory & Intercultural Spaces" },
            { day: 2, start: 12.5, duration: 60, type: 'opening', titleFr: "Reflection Time", titleEn: "Reflection Time" },
            { day: 2, start: 13.5, duration: 120, type: 'elearning', titleFr: "10. Du besoin aux objectifs d‚Äôapprentissage et indicateurs", titleEn: "10. From Needs to Learning Objectives & Indicators" },
            { day: 2, start: 15.5, duration: 120, type: 'elearning', titleFr: "11. Concevoir une progression p√©dagogique", titleEn: "11. Designing Pedagogical Progression" },

            // --- JOUR 4 ---
            { day: 3, start: 7.5, duration: 30, type: 'opening', titleFr: "Ouverture salle virtuelle", titleEn: "Virtual Room Opening" },
            { day: 3, start: 8.0, duration: 210, type: 'synchrone', titleFr: "12. Construire le d√©roul√© d'une animation", titleEn: "12. Building an Animation Flow" },
            { day: 3, start: 11.5, duration: 60, type: 'elearning', titleFr: "13. Garantir inclusion, s√©curit√© & aspects l√©gaux", titleEn: "13. Ensuring Inclusion, Safety & Legal Aspects" },
            { day: 3, start: 12.5, duration: 60, type: 'opening', titleFr: "Reflection Time", titleEn: "Reflection Time" },
            { day: 3, start: 13.5, duration: 120, type: 'elearning', titleFr: "14. Budget, administratif et logistique: Boite √† outils", titleEn: "14. Budget, Admin & Logistics: Toolkit" },
            { day: 3, start: 15.5, duration: 120, type: 'blended', titleFr: "12 bis. Construire le d√©roul√© d'une animation (Suite)", titleEn: "12 bis. Building an Animation Flow (Cont.)" },

            // --- JOUR 5 ---
            { day: 4, start: 7.5, duration: 30, type: 'opening', titleFr: "Ouverture salle virtuelle", titleEn: "Virtual Room Opening" },
            { day: 4, start: 8.0, duration: 120, type: 'synchrone', titleFr: "15. Posture de facilitation & apprentissage actif", titleEn: "15. Facilitation Posture & Active Learning" },
            { day: 4, start: 10.0, duration: 30, type: 'break', titleFr: "Pause", titleEn: "Break" },
            { day: 4, start: 10.5, duration: 60, type: 'blended', titleFr: "16. Dynamiques de groupe & conflits", titleEn: "16. Group Dynamics & Conflicts" },
            { day: 4, start: 11.5, duration: 60, type: 'elearning', titleFr: "17. √âvaluation formative & d√©briefings", titleEn: "17. Formative Assessment & Debriefings" },
            { day: 4, start: 12.5, duration: 60, type: 'opening', titleFr: "Reflection / Pause", titleEn: "Reflection / Break" },
            { day: 4, start: 13.5, duration: 240, type: 'blended', titleFr: "15 bis. Posture de facilitation & apprentissage actif ACTION !!!", titleEn: "15 bis. Facilitation Posture & Active Learning ACTION !!!" },
            { day: 4, start: 17.5, duration: 180, type: 'social', titleFr: "Ouverture du social club", titleEn: "Social Club Opening" },

            // --- JOUR 6 ---
            { day: 5, start: 7.5, duration: 30, type: 'opening', titleFr: "Ouverture salle virtuelle", titleEn: "Virtual Room Opening" },
            { day: 5, start: 8.0, duration: 120, type: 'elearning', titleFr: "18. Evaluation & la capitalisation", titleEn: "18. Evaluation & Capitalization" },
            { day: 5, start: 10.0, duration: 30, type: 'break', titleFr: "Pause", titleEn: "Break" },
            { day: 5, start: 10.5, duration: 120, type: 'blended', titleFr: "19. Reconnaissance des apprentissages & Youthpass", titleEn: "19. Learning Recognition & Youthpass" },
            { day: 5, start: 12.5, duration: 60, type: 'break', titleFr: "Pause", titleEn: "Break" },
            { day: 5, start: 13.5, duration: 90, type: 'blended', titleFr: "20. Promouvoir les initiatives de jeunesse", titleEn: "20. Promoting Youth Initiatives" },
            { day: 5, start: 15.0, duration: 30, type: 'break', titleFr: "Pause", titleEn: "Break" },
            { day: 5, start: 15.5, duration: 120, type: 'synchrone', titleFr: "21. Plan de d√©veloppement professionnel & cl√¥ture", titleEn: "21. Professional Development Plan & Closing" },
        ];

        // --- √âTAT GLOBAL ---
        let currentState = {
            lang: 'fr',
            timezoneId: 'fr',
            view: 'week', // 'week' ou 'day'
            selectedDay: 0 // 0 √† 5
        };

        // --- ICONES SVG ---
        const icons = {
            calendar: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-red-600"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>`,
            clock: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-slate-400"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
            chevronDown: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-slate-400 pointer-events-none"><path d="m6 9 6 6 6-6"/></svg>`,
            coffee: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-3 h-3 inline"><path d="M10 2v2"/><path d="M14 2v2"/><path d="M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 0 1 4 4v1a4 4 0 0 1-4 4h-1"/><line x1="6" x2="6" y1="2" y2="4"/></svg>`,
            coffeeLarge: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-3 h-3 text-fuchsia-600"><path d="M10 2v2"/><path d="M14 2v2"/><path d="M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 0 1 4 4v1a4 4 0 0 1-4 4h-1"/><line x1="6" x2="6" y1="2" y2="4"/></svg>`,
            grid: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>`,
            list: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>`,
            arrowLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>`,
            arrowRight: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>`
        };

        // --- FONCTIONS LOGIQUES ---

        function getVirtualTime() {
            const now = new Date();
            // Heure UTC d√©cimale
            const utc = now.getUTCHours() + now.getUTCMinutes() / 60;
            // R√©cup√©rer offset
            const currentTz = timezones.find(tz => tz.id === currentState.timezoneId) || timezones[0];
            
            // Appliquer offset (gestion du passage minuit)
            let virtual = (utc + currentTz.offset);
            if (virtual < 0) virtual += 24;
            if (virtual >= 24) virtual -= 24;
            
            return virtual;
        }

        function formatDecimalTime(decimalTime) {
            let hour = Math.floor(decimalTime);
            let minutes = Math.round((decimalTime - hour) * 60);
            return `${hour.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        function formatTime(baseHour) {
            const currentTz = timezones.find(tz => tz.id === currentState.timezoneId) || timezones[0];
            let hour = Math.floor(baseHour);
            let minutes = Math.round((baseHour - hour) * 60);
            hour = (hour + currentTz.offset) % 24;
            const hStr = hour.toString().padStart(2, '0');
            const mStr = minutes.toString().padStart(2, '0');
            return `${hStr}:${mStr}`;
        }

        function getEventStyle(type) {
            switch (type) {
                case 'synchrone': return 'bg-red-50 border-l-4 border-red-500 text-red-900 hover:bg-red-100';
                case 'elearning': return 'bg-emerald-50 border-l-4 border-emerald-500 text-emerald-900 hover:bg-emerald-100';
                case 'blended': return 'bg-blue-50 border-l-4 border-blue-500 text-blue-900 hover:bg-blue-100';
                case 'opening': return 'bg-amber-50 border-l-4 border-amber-400 text-amber-900 hover:bg-amber-100 italic';
                case 'break': return 'bg-slate-50 border-l-4 border-slate-200 text-slate-400 text-xs py-1 border-dashed';
                case 'social': return 'bg-fuchsia-50 border-l-4 border-fuchsia-500 text-fuchsia-900 hover:bg-fuchsia-100 shadow-md';
                default: return 'bg-gray-100';
            }
        }

        function getEventIcon(type) {
             switch(type) {
                case 'synchrone': return 'üî¥';
                case 'elearning': return 'üü¢';
                case 'blended': return 'üîµ';
                case 'opening': return 'üü°';
                case 'break': return '‚ö™';
                case 'social': return icons.coffee;
                default: return '';
            }
        }

        function getParallelSocialClub(dayIndex) {
            // Jours 1, 2, 3 (Indices 0, 1, 2) : 13h30 - 17h30
            if (dayIndex >= 0 && dayIndex <= 2) {
                return { start: 13.5, duration: 240 }; 
            }
            // Jour 4 (Index 3) : 11h30 - 17h30 (6h = 360min)
            if (dayIndex === 3) {
                return { start: 11.5, duration: 360 };
            }
            return null;
        }

        // --- RENDU VUE SEMAINE (GRID) ---
        function renderWeekView(t) {
            let html = `<div class="overflow-x-auto pb-4 fade-in"><div class="min-w-[1000px] grid grid-cols-6 gap-2">`;
            
            for (let dayIdx = 0; dayIdx < 6; dayIdx++) {
                const dayEvents = scheduleData.filter(e => e.day === dayIdx).sort((a, b) => a.start - b.start);
                const parallelSocial = getParallelSocialClub(dayIdx);

                html += `
                    <div class="flex flex-col">
                        <div class="bg-slate-800 text-white p-3 text-center rounded-t-lg shadow-sm flex flex-col items-center justify-start min-h-[90px] cursor-pointer hover:bg-slate-700 transition-colors" onclick="setDay(${dayIdx}); setView('day')">
                            <span class="font-bold text-sm uppercase tracking-wide block mb-1 text-red-300">${t.days[dayIdx]}</span>
                            <span class="text-[10px] leading-tight font-medium opacity-95 block">${t.day_themes[dayIdx]}</span>
                        </div>
                        <div class="flex flex-col bg-white rounded-b-lg shadow border border-slate-200 min-h-[600px] relative pb-2">
                            <div class="p-2 flex flex-col gap-2 flex-grow">
                `;

                dayEvents.forEach(evt => {
                    const styleClass = getEventStyle(evt.type);
                    const title = currentState.lang === 'fr' ? evt.titleFr : evt.titleEn;
                    const timeRange = `${formatTime(evt.start)}${evt.type !== 'break' ? ' - ' + formatTime(evt.start + evt.duration/60) : ''}`;
                    const containerClass = evt.type === 'break' ? 'opacity-70' : 'shadow-sm hover:shadow-md';
                    
                    html += `
                        <div class="rounded p-2 ${styleClass} ${containerClass}">
                            <div class="flex justify-between items-start mb-1">
                                <span class="font-mono font-bold text-[10px] px-1.5 rounded ${evt.type === 'break' ? 'bg-slate-200' : 'bg-white/60'}">${timeRange}</span>
                                ${evt.type !== 'break' ? `<span class="text-xs">${getEventIcon(evt.type)}</span>` : ''}
                            </div>
                            <div class="leading-tight ${evt.type === 'break' ? 'text-center text-[10px] uppercase font-bold tracking-widest' : 'font-semibold text-xs'}">${title}</div>
                        </div>
                    `;
                });

                html += `</div>`; // End content

                if (parallelSocial) {
                    html += `
                        <div class="mt-auto mx-2 mb-2 p-2 rounded bg-fuchsia-50 border border-fuchsia-200 border-dashed text-fuchsia-900">
                             <div class="flex items-center gap-2 mb-1">
                                ${icons.coffeeLarge}
                                <span class="text-[10px] font-bold uppercase tracking-wide">${t.social_club_title}</span>
                             </div>
                             <span class="font-mono font-bold text-[10px] bg-white/50 px-1 rounded inline-block">${formatTime(parallelSocial.start)} - ${formatTime(parallelSocial.start + parallelSocial.duration/60)}</span>
                        </div>
                    `;
                }
                html += `</div></div>`;
            }
            html += `</div></div>`;
            return html;
        }

        // --- RENDU VUE JOURN√âE (TIMELINE) ---
        function renderDayView(t) {
            const dayIdx = currentState.selectedDay;
            const dayEvents = scheduleData.filter(e => e.day === dayIdx).sort((a, b) => a.start - b.start);
            const parallelSocial = getParallelSocialClub(dayIdx);
            
            // Calcul du temps actuel pour l'indicateur
            const nowTime = getVirtualTime();

            let html = `
                <div class="max-w-3xl mx-auto fade-in">
                    <!-- Day Nav -->
                    <div class="flex items-center justify-between mb-6 bg-slate-800 text-white p-4 rounded-xl shadow-lg">
                        <button ${dayIdx === 0 ? 'disabled class="opacity-30"' : `onclick="setDay(${dayIdx - 1})"`} class="p-2 hover:bg-slate-700 rounded-full transition-colors flex items-center gap-2 text-sm font-semibold">
                            ${icons.arrowLeft} <span class="hidden sm:inline">${t.prev_day}</span>
                        </button>
                        <div class="text-center">
                            <h2 class="text-2xl font-bold text-red-300">${t.days[dayIdx]}</h2>
                            <p class="text-sm opacity-90 max-w-md mx-auto">${t.day_themes[dayIdx]}</p>
                        </div>
                        <button ${dayIdx === 5 ? 'disabled class="opacity-30"' : `onclick="setDay(${dayIdx + 1})"`} class="p-2 hover:bg-slate-700 rounded-full transition-colors flex items-center gap-2 text-sm font-semibold">
                            <span class="hidden sm:inline">${t.next_day}</span> ${icons.arrowRight}
                        </button>
                    </div>
                    
                    <!-- Global Time Display -->
                    <div class="text-center mb-6 text-slate-500 text-sm font-medium">
                        ${t.current_time} <span class="text-red-600 font-mono font-bold text-lg">${formatDecimalTime(nowTime)}</span> (Zone S√©lectionn√©e)
                    </div>

                    <div class="flex flex-col gap-4 relative">
            `;

            dayEvents.forEach(evt => {
                const title = currentState.lang === 'fr' ? evt.titleFr : evt.titleEn;
                // Calcul des heures locales pour cet event
                const currentTz = timezones.find(tz => tz.id === currentState.timezoneId) || timezones[0];
                const localStart = (evt.start + currentTz.offset) % 24;
                const localEnd = (evt.start + evt.duration/60 + currentTz.offset) % 24;
                // Note: la comparaison pour "now" doit se faire sur les heures relatives ajust√©es (modulo 24 si on d√©passe, mais attention au changement de jour pour la logique pure)
                // Pour simplifier, on compare sur l'heure virtuelle calcul√©e qui est d√©j√† modul√©e.
                // Attention: Si l'event passe minuit, cette logique simple √©choue, mais ici les cours sont en journ√©e.
                
                // Le start/end stock√© est base FR. On convertit 'nowTime' en base FR pour comparer plus s√ªrement, ou on convertit tout en base "Affichage".
                // Option simple: Convertir start/end en base "Affichage" pour l'affichage, et utiliser ces valeurs pour la comparaison avec nowTime.
                
                let displayStart = evt.start + currentTz.offset;
                let displayEnd = evt.start + evt.duration/60 + currentTz.offset;
                
                // Check si c'est "maintenant"
                // On utilise une tol√©rance car nowTime est 0-24 et display peut d√©passer si on ne modulo pas, mais getVirtualTime modulo 24.
                // Donc on modulo les display pour comparer
                const modStart = displayStart % 24;
                const modEnd = displayEnd % 24;
                
                // Cas simple journ√©e
                const isCurrent = (nowTime >= modStart && nowTime < modEnd);
                
                // Calcul pourcentage progression
                let progressPercent = 0;
                if(isCurrent) {
                    progressPercent = ((nowTime - modStart) / (modEnd - modStart)) * 100;
                }

                const timeStartStr = formatDecimalTime(modStart);
                const timeEndStr = formatDecimalTime(modEnd);
                
                // Logic for Parallelism
                const isAfternoonOverlap = parallelSocial && evt.start >= parallelSocial.start && evt.start < (parallelSocial.start + parallelSocial.duration/60);

                if (isAfternoonOverlap) {
                    // SPLIT VIEW: EVENT + SOCIAL CLUB
                    html += `
                        <div class="grid grid-cols-1 md:grid-cols-[100px_1fr_1fr] gap-4 items-stretch group">
                            <!-- Time -->
                            <div class="text-right md:border-r-2 md:border-slate-200 pr-4 pt-4 relative">
                                <span class="font-mono text-lg font-bold ${isCurrent ? 'text-red-600' : 'text-slate-700'} block">${timeStartStr}</span>
                                <span class="font-mono text-sm text-slate-400 block">${timeEndStr}</span>
                                ${isCurrent ? `<span class="hidden md:block absolute top-6 right-[-65px] bg-red-600 text-white text-[9px] font-bold px-1 rounded z-20">${t.now_badge}</span>` : ''}
                            </div>
                            
                            <!-- Main Event -->
                            <div class="rounded-xl p-4 shadow-md ${getEventStyle(evt.type)} flex flex-col justify-center relative overflow-hidden transition-all ${isCurrent ? 'ring-2 ring-red-400 ring-offset-2' : ''}">
                                ${isCurrent ? `<div class="now-indicator-line" style="top: ${progressPercent}%;"></div>` : ''}
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-lg">${getEventIcon(evt.type)}</span>
                                    <span class="text-xs uppercase font-bold tracking-wider opacity-70">${evt.type}</span>
                                </div>
                                <h3 class="font-bold text-lg leading-tight mb-1">${title}</h3>
                            </div>

                            <!-- Social Club (Parallel) -->
                            <div class="rounded-xl p-4 shadow-sm bg-fuchsia-50 border-2 border-fuchsia-200 border-dashed text-fuchsia-900 flex flex-col justify-center relative opacity-90 hover:opacity-100 transition-opacity">
                                <div class="flex items-center gap-2 mb-2">
                                    ${icons.coffeeLarge}
                                    <span class="text-xs uppercase font-bold tracking-wider opacity-70">${t.social_club_title}</span>
                                </div>
                                <p class="text-sm font-medium leading-tight">${t.social_club_parallel}</p>
                            </div>
                        </div>
                    `;
                } else {
                    // STANDARD VIEW
                    const isBreak = evt.type === 'break';
                    html += `
                        <div class="grid grid-cols-1 md:grid-cols-[100px_1fr] gap-4 items-stretch group">
                            <div class="text-right md:border-r-2 md:border-slate-200 pr-4 pt-3 relative">
                                <span class="font-mono text-lg font-bold ${isCurrent ? 'text-red-600' : 'text-slate-700'} block">${timeStartStr}</span>
                                ${!isBreak ? `<span class="font-mono text-sm text-slate-400 block">${timeEndStr}</span>` : ''}
                                ${isCurrent ? `<span class="hidden md:block absolute top-5 right-[-65px] bg-red-600 text-white text-[9px] font-bold px-1 rounded z-20">${t.now_badge}</span>` : ''}
                                <div class="hidden md:block absolute top-5 -right-[9px] w-4 h-4 ${isCurrent ? 'bg-red-500 animate-pulse' : (isBreak ? 'bg-slate-300' : 'bg-slate-400')} rounded-full border-4 border-slate-100"></div>
                            </div>
                            <div class="rounded-xl p-4 ${isBreak ? 'bg-slate-50 border border-slate-200 border-dashed text-center py-2' : `shadow-md ${getEventStyle(evt.type)}`} relative overflow-hidden transition-all ${isCurrent ? 'ring-2 ring-red-400 ring-offset-2' : ''}">
                                ${isCurrent && !isBreak ? `<div class="now-indicator-line" style="top: ${progressPercent}%;"></div>` : ''}
                                ${!isBreak ? `
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-lg">${getEventIcon(evt.type)}</span>
                                        <span class="text-xs uppercase font-bold tracking-wider opacity-70">${evt.type}</span>
                                    </div>
                                ` : ''}
                                <h3 class="${isBreak ? 'text-slate-400 font-bold uppercase tracking-widest text-sm' : 'font-bold text-lg leading-tight'}">${title}</h3>
                            </div>
                        </div>
                    `;
                }
            });

            html += `</div></div>`;
            return html;
        }

        // --- RENDU PRINCIPAL ---
        function render() {
            const t = translations[currentState.lang];
            const app = document.getElementById('app');
            
            let html = `
                <!-- HEADER -->
                <header class="mb-6 bg-white rounded-xl shadow-sm border border-slate-200 p-4 lg:p-6">
                    <div class="flex flex-col lg:flex-row justify-between items-center gap-6">
                        <div class="flex items-center gap-4 w-full lg:w-auto">
                            <div class="p-3 bg-red-50 rounded-lg">
                                ${icons.calendar}
                            </div>
                            <div>
                                <h1 class="text-2xl font-bold text-slate-800 leading-none mb-1">${t.title}</h1>
                                <p class="text-slate-500 font-medium">${t.subtitle}</p>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto">
                            <!-- View Toggle -->
                            <div class="bg-slate-100 p-1 rounded-lg flex border border-slate-200">
                                <button onclick="setView('week')" class="flex items-center gap-2 px-4 py-2 rounded-md text-sm font-bold transition-all ${currentState.view === 'week' ? 'bg-white shadow text-slate-800' : 'text-slate-500 hover:bg-slate-200'}">
                                    ${icons.grid} <span class="hidden sm:inline">${t.view_week}</span>
                                </button>
                                <button onclick="setView('day')" class="flex items-center gap-2 px-4 py-2 rounded-md text-sm font-bold transition-all ${currentState.view === 'day' ? 'bg-white shadow text-slate-800' : 'text-slate-500 hover:bg-slate-200'}">
                                    ${icons.list} <span class="hidden sm:inline">${t.view_day}</span>
                                </button>
                            </div>

                            <!-- Timezone -->
                            <div class="relative">
                                <div class="absolute inset-y-0 left-3 flex items-center pointer-events-none">${icons.clock}</div>
                                <select id="timezone-select" class="w-full sm:w-auto pl-10 pr-8 py-2.5 bg-white border border-slate-200 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none cursor-pointer hover:border-slate-300 shadow-sm">
                                    ${timezones.map(tz => `<option value="${tz.id}" ${currentState.timezoneId === tz.id ? 'selected' : ''}>${tz.flag} ${tz.name}</option>`).join('')}
                                </select>
                            </div>

                            <!-- Lang -->
                            <div class="flex bg-slate-100 rounded-lg p-1 border border-slate-200">
                                <button onclick="setLang('fr')" class="px-3 py-1 text-xs font-bold rounded transition-colors ${currentState.lang === 'fr' ? 'bg-white shadow text-red-600' : 'text-slate-500 hover:text-slate-700'}">FR</button>
                                <button onclick="setLang('en')" class="px-3 py-1 text-xs font-bold rounded transition-colors ${currentState.lang === 'en' ? 'bg-white shadow text-red-600' : 'text-slate-500 hover:text-slate-700'}">EN</button>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- LEGEND -->
                ${currentState.view === 'week' ? `
                <div class="mb-6 flex flex-wrap justify-center gap-3 text-xs opacity-80">
                    <div class="flex items-center gap-1.5 px-2 py-1 bg-red-50 text-red-800 rounded border border-red-200"><span class="text-sm">üî¥</span> ${t.legend_synchrone}</div>
                    <div class="flex items-center gap-1.5 px-2 py-1 bg-emerald-50 text-emerald-800 rounded border border-emerald-200"><span class="text-sm">üü¢</span> ${t.legend_elearning}</div>
                    <div class="flex items-center gap-1.5 px-2 py-1 bg-blue-50 text-blue-800 rounded border border-blue-200"><span class="text-sm">üîµ</span> ${t.legend_blended}</div>
                    <div class="flex items-center gap-1.5 px-2 py-1 bg-amber-50 text-amber-800 rounded border border-amber-200"><span class="text-sm">üü°</span> ${t.legend_opening}</div>
                    <div class="flex items-center gap-1.5 px-2 py-1 bg-fuchsia-50 text-fuchsia-800 rounded border border-fuchsia-200">${icons.coffeeLarge} ${t.legend_social}</div>
                </div>` : ''}

                <!-- VIEW CONTENT -->
                ${currentState.view === 'week' ? renderWeekView(t) : renderDayView(t)}
                
                <div class="text-center text-slate-400 text-[10px] mt-6 border-t border-slate-200 pt-4">
                    ${t.note}
                </div>
            `;

            app.innerHTML = html;
            
            document.getElementById('timezone-select').addEventListener('change', (e) => {
                currentState.timezoneId = e.target.value;
                render();
            });
        }

        // --- ACTIONS ---
        function setLang(lang) { currentState.lang = lang; render(); }
        function setView(view) { currentState.view = view; render(); }
        function setDay(dayIdx) { 
            currentState.selectedDay = dayIdx; 
            render(); 
        }

        // Auto-refresh every minute for time line
        setInterval(render, 60000);
        render();
    </script>
</body>
</html>

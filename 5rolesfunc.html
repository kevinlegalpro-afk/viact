<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Rôles Coopératifs</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Styles spécifiques pour l'impression */
        @media print {
            @page { margin: 1cm; size: A4 portrait; }
            .no-print { display: none !important; }
            body { 
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact; 
                background: white; 
            }
            .print-break-before { break-before: page; }
            
            /* S'assurer que les grilles s'impriment bien */
            .print-grid {
                display: block !important;
                text-align: center;
            }
            .print-card-wrapper {
                display: inline-block !important;
                margin: 0 10px 20px 10px !important;
                page-break-inside: avoid;
                break-inside: avoid;
            }
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">

    <!-- Bouton Langue Flottant -->
    <div class="fixed top-4 right-4 z-50 no-print">
        <button onclick="toggleLang()" class="bg-white/90 backdrop-blur shadow-md border border-gray-200 px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 hover:bg-gray-50 transition-all cursor-pointer">
            <i data-lucide="globe" class="w-4 h-4"></i>
            <span id="lang-label">FR</span>
        </button>
    </div>

    <!-- Conteneur Principal -->
    <div id="app" class="p-4">
        <!-- Le contenu sera injecté ici par JavaScript -->
    </div>

    <script>
        // --- DONNÉES & TRADUCTIONS ---
        
        const TRANSLATIONS = {
            fr: {
                appTitle: "Générateur de Rôles Coopératifs",
                subtitle: "Distribuez des responsabilités claires pour dynamiser vos travaux de groupe.",
                startFull: "Le Set Complet",
                startFullDesc: "Accéder à toutes les cartes pour composer vos groupes librement.",
                startQuiz: "Assistant Intelligent",
                startQuizDesc: "Répondez à quelques questions pour obtenir la combinaison parfaite.",
                printBtn: "Imprimer / PDF",
                withBacks: "Inclure les versos (pour impression recto-verso)",
                printTipTitle: "Conseil d'impression",
                printTip: "Pour imprimer les versos : imprimez d'abord la page des faces. Remettez les feuilles dans l'imprimante, puis imprimez uniquement la page des versos. Assurez-vous que l'option 'Graphiques d'arrière-plan' est activée.",
                backToHome: "Retour à l'accueil",
                generatedTitle: "Vos Cartes de Rôles",
                
                // Intro & Usage
                introTitle: "Pourquoi utiliser ces cartes ?",
                introText: "Ces cartes sont essentielles pour structurer le travail collaboratif. Elles responsabilisent chaque participant, évitent l'effet 'passager clandestin' (celui qui ne fait rien) et assurent une dynamique de groupe fluide et productive.",
                usageTitle: "3 Façons de les utiliser",
                usage1Title: "1. Le Hasard (Polyvalence)",
                usage1Text: "Distribuez les cartes face cachée. Cela force chacun à pratiquer des compétences variées et évite les rôles figés.",
                usage2Title: "2. Le Talent (Expertise)",
                usage2Text: "Donnez des rôles fonctionnels aux personnes qui ont déjà un talent constaté (ex: un bon dessinateur devient Designer) pour valoriser leurs compétences et renforcer leur confiance.",
                usage3Title: "3. Le Challenge (Zone de confort)",
                usage3Text: "Attribuez des rôles pour faire sortir les personnes de leurs habitudes.",
                usage3Ex: "Exemple : Donnez le rôle d'Orateur à une personne timide pour l'encourager à parler, ou le rôle de Gardien du Temps à une personne qui a tendance à se disperser pour l'aider à se canaliser.",

                // Quiz
                q_groupSize: "Combien de personnes y a-t-il par groupe ?",
                q_outputType: "Quel est le type de rendu final ?",
                q_duration: "Quelle est la durée du travail ?",
                q_context: "Quel est le plus grand défi pour ce groupe ?",
                opt_written: "Écrit (Rédaction, rapport...)",
                opt_oral: "Oral (Présentation, théâtre...)",
                opt_creative: "Visuel / Créatif (Affiche...)",
                opt_logic: "Résolution de problème / Exercices",
                opt_short: "Court (moins de 30 min)",
                opt_long: "Long / Projet (plusieurs heures)",
                opt_focus: "Rester concentré",
                opt_conflict: "Gérer les conflits",
                opt_depth: "Approfondir le sujet",
                opt_none: "Aucun défi particulier",
                
                mission: "Mission",
                tasks: "Responsabilités",
                cancel: "Annuler",
                question: "Question",
                backPreview: "Aperçu des Versos"
            },
            en: {
                appTitle: "Cooperative Role Generator",
                subtitle: "Assign clear responsibilities to boost your group work dynamics.",
                startFull: "Full Card Set",
                startFullDesc: "Access all cards to compose your groups freely.",
                startQuiz: "Smart Assistant",
                startQuizDesc: "Answer a few questions to get the perfect role combination.",
                printBtn: "Print / PDF",
                withBacks: "Include card backs (for double-sided printing)",
                printTipTitle: "Printing Tip",
                printTip: "To print backs: First print the front pages. Re-insert paper, then print only the back pages. Ensure 'Background Graphics' is enabled in browser settings.",
                backToHome: "Back to Home",
                generatedTitle: "Your Role Cards",

                // Intro & Usage
                introTitle: "Why use these cards?",
                introText: "These cards are essential for structuring collaborative work. They empower every participant, prevent the 'free rider' effect, and ensure smooth and productive group dynamics.",
                usageTitle: "3 Ways to use them",
                usage1Title: "1. Random (Versatility)",
                usage1Text: "Distribute cards face down. This forces everyone to practice various skills and avoids fixed roles.",
                usage2Title: "2. Talent (Expertise)",
                usage2Text: "Assign functional roles to people with proven talents (e.g., a good drawer becomes the Designer) to value their skills and boost confidence.",
                usage3Title: "3. Challenge (Comfort Zone)",
                usage3Text: "Assign roles to push people out of their habits.",
                usage3Ex: "Example: Assign the Speaker role to a shy person to encourage them, or the Timekeeper role to someone who tends to lose focus to help them channel their energy.",

                // Quiz
                q_groupSize: "How many people per group?",
                q_outputType: "What is the final output?",
                q_duration: "What is the duration?",
                q_context: "What is the biggest challenge?",
                opt_written: "Written (Essay, report...)",
                opt_oral: "Oral (Presentation, speech...)",
                opt_creative: "Visual / Creative (Poster...)",
                opt_logic: "Problem Solving / Exercises",
                opt_short: "Short (less than 30 min)",
                opt_long: "Long / Project (multiple hours)",
                opt_focus: "Staying focused",
                opt_conflict: "Managing conflicts",
                opt_depth: "Going deeper",
                opt_none: "No specific challenge",

                mission: "Mission",
                tasks: "Responsibilities",
                cancel: "Cancel",
                question: "Question",
                backPreview: "Back Preview"
            }
        };

        const ROLES_DATA = [
            {
                id: 'coordinateur',
                icon: 'users',
                color: 'from-blue-500 to-blue-600',
                textColor: 'text-blue-600',
                borderColor: 'border-blue-200',
                bgPattern: 'bg-blue-50',
                content: {
                fr: { title: 'Le Coordinateur', mission: "S'assure que tout le monde participe et que l'objectif est clair.", tasks: ["Vérifie que chacun a la parole.", "Reformule les consignes.", "S'assure que le groupe avance.", "Gère les votes si nécessaire."], phrase: "« Est-ce que tout le monde est d'accord pour avancer ? »" },
                en: { title: 'The Coordinator', mission: "Ensures everyone participates and the goal is clear.", tasks: ["Checks everyone has a say.", "Rephrases instructions.", "Ensures the group moves forward.", "Manages votes if needed."], phrase: "“Is everyone agreed to move on?”" }
                }
            },
            {
                id: 'gardien_temps',
                icon: 'clock',
                color: 'from-red-500 to-red-600',
                textColor: 'text-red-600',
                borderColor: 'border-red-200',
                bgPattern: 'bg-red-50',
                content: {
                fr: { title: 'Gardien du Temps', mission: "Gère le timing pour que le travail soit fini à l'heure.", tasks: ["Surveille la montre/chrono.", "Annonce le temps restant.", "Encourage à accélérer si besoin.", "Aide à ne pas faire de hors-sujet."], phrase: "« Attention, il ne nous reste que 5 minutes ! »" },
                en: { title: 'Time Keeper', mission: "Manages timing so work is finished on time.", tasks: ["Watches the clock/timer.", "Announces remaining time.", "Encourages speed if needed.", "Prevents off-topic chatter."], phrase: "“Careful, only 5 minutes left!”" }
                }
            },
            {
                id: 'scribe',
                icon: 'pen-tool',
                color: 'from-emerald-500 to-emerald-600',
                textColor: 'text-emerald-600',
                borderColor: 'border-emerald-200',
                bgPattern: 'bg-emerald-50',
                content: {
                fr: { title: 'Le Scribe', mission: "Note les idées principales et rédige le rendu final.", tasks: ["Écrit lisiblement pour le groupe.", "Note les décisions validées.", "Fait valider ce qu'il écrit.", "Soigne l'orthographe."], phrase: "« Attendez, je note cette idée. Comment on la formule ? »" },
                en: { title: 'The Scribe', mission: "Notes key ideas and writes the final output.", tasks: ["Writes legibly for the group.", "Notes validated decisions.", "Validates text with the group.", "Checks spelling/grammar."], phrase: "“Wait, I'm writing that down. How should we phrase it?”" }
                }
            },
            {
                id: 'orateur',
                icon: 'mic',
                color: 'from-amber-500 to-amber-600',
                textColor: 'text-amber-600',
                borderColor: 'border-amber-200',
                bgPattern: 'bg-amber-50',
                content: {
                fr: { title: 'Le Porte-Parole', mission: "Présente le travail du groupe à la classe.", tasks: ["Prépare la présentation orale.", "S'entraîne à parler fort.", "Demande des précisions au groupe.", "Répond aux questions."], phrase: "« Si on me demande ça, qu'est-ce que je dois répondre ? »" },
                en: { title: 'The Speaker', mission: "Presents the group's work to the class.", tasks: ["Prepares the oral presentation.", "Practices speaking clearly.", "Asks group for details.", "Answers questions."], phrase: "“If they ask me that, what should I answer?”" }
                }
            },
            {
                id: 'chercheur',
                icon: 'search',
                color: 'from-indigo-500 to-indigo-600',
                textColor: 'text-indigo-600',
                borderColor: 'border-indigo-200',
                bgPattern: 'bg-indigo-50',
                content: {
                fr: { title: 'Le Chercheur', mission: "Trouve les informations et vérifie les ressources.", tasks: ["Cherche dans le manuel/web.", "Vérifie les définitions.", "Apporte les documents nécessaires.", "Trie les infos utiles."], phrase: "« J'ai trouvé une info importante à la page 42. »" },
                en: { title: 'The Researcher', mission: "Finds information and checks resources.", tasks: ["Searches textbook/web.", "Checks definitions.", "Brings necessary docs.", "Sorts useful info."], phrase: "“I found something important on page 42.”" }
                }
            },
            {
                id: 'mediateur',
                icon: 'shield-check',
                color: 'from-rose-400 to-rose-500',
                textColor: 'text-rose-500',
                borderColor: 'border-rose-200',
                bgPattern: 'bg-rose-50',
                content: {
                fr: { title: 'Le Médiateur', mission: "Assure une bonne ambiance et résout les conflits.", tasks: ["Calme le jeu si le ton monte.", "Félicite les bonnes idées.", "S'assure que personne n'est exclu.", "Encourage la bienveillance."], phrase: "« On se calme, écoutons l'idée de Thomas. »" },
                en: { title: 'The Mediator', mission: "Ensures good vibes and resolves conflicts.", tasks: ["Calms things down if heated.", "Praises good ideas.", "Ensures no one is excluded.", "Encourages kindness."], phrase: "“Let's calm down and listen to Thomas's idea.”" }
                }
            },
            {
                id: 'designer',
                icon: 'palette',
                color: 'from-purple-500 to-purple-600',
                textColor: 'text-purple-600',
                borderColor: 'border-purple-200',
                bgPattern: 'bg-purple-50',
                content: {
                fr: { title: 'Le Designer', mission: "S'occupe de la mise en forme visuelle et des schémas.", tasks: ["Dessine les schémas/cartes.", "Organise la mise en page.", "Gère le matériel (feutres...).", "Rend le travail esthétique."], phrase: "« On pourrait faire un schéma pour expliquer ça ? »" },
                en: { title: 'The Designer', mission: "Handles visual layout and diagrams.", tasks: ["Draws diagrams/maps.", "Organizes layout.", "Manages materials (pens...).", "Makes work aesthetic."], phrase: "“Could we make a diagram to explain this?”" }
                }
            },
            {
                id: 'critique',
                icon: 'lightbulb',
                color: 'from-cyan-500 to-cyan-600',
                textColor: 'text-cyan-600',
                borderColor: 'border-cyan-200',
                bgPattern: 'bg-cyan-50',
                content: {
                fr: { title: 'Le Critique', mission: "Pose des questions pour améliorer le travail.", tasks: ["Vérifie si on a tout traité.", "Questionne la logique.", "Propose des améliorations.", "S'assure de la qualité."], phrase: "« Est-ce qu'on est sûrs que c'est juste ? »" },
                en: { title: 'The Critic', mission: "Asks questions to improve the work.", tasks: ["Checks if everything is covered.", "Questions the logic.", "Proposes improvements.", "Ensures quality."], phrase: "“Are we sure this is correct?”" }
                }
            }
        ];

        // --- ÉTAT DE L'APPLICATION ---
        let currentLang = 'fr';
        let currentMode = 'home'; // home, quiz, results
        let selectedRoles = [];
        let quizStep = 0;
        let answers = {};
        let printBacks = true;

        // --- LOGIQUE METIER ---
        
        function toggleLang() {
            currentLang = currentLang === 'fr' ? 'en' : 'fr';
            document.getElementById('lang-label').innerText = currentLang.toUpperCase();
            renderApp();
        }

        function setMode(mode) {
            currentMode = mode;
            renderApp();
        }

        function resetApp() {
            quizStep = 0;
            answers = {};
            selectedRoles = [];
            setMode('home');
        }

        function togglePrintBacks(checked) {
            printBacks = checked;
            renderResults(); // Re-render results to show/hide backs
        }

        // Logique du Quiz
        function getQuestions() {
            const t = TRANSLATIONS[currentLang];
            return [
                { id: 'groupSize', question: t.q_groupSize, options: [{ label: "3", value: 3 }, { label: "4", value: 4 }, { label: "5", value: 5 }, { label: "6+", value: 6 }] },
                { id: 'outputType', question: t.q_outputType, options: [{ label: t.opt_written, value: 'written' }, { label: t.opt_oral, value: 'oral' }, { label: t.opt_creative, value: 'creative' }, { label: t.opt_logic, value: 'logic' }] },
                { id: 'duration', question: t.q_duration, options: [{ label: t.opt_short, value: 'short' }, { label: t.opt_long, value: 'long' }] },
                { id: 'context', question: t.q_context, options: [{ label: t.opt_focus, value: 'focus' }, { label: t.opt_conflict, value: 'conflict' }, { label: t.opt_depth, value: 'depth' }, { label: t.opt_none, value: 'none' }] }
            ];
        }

        function handleQuizAnswer(value) {
            const questions = getQuestions();
            const currentQ = questions[quizStep];
            answers[currentQ.id] = value;

            if (quizStep < questions.length - 1) {
                quizStep++;
                renderQuiz();
            } else {
                generateRoles();
            }
        }

        function generateRoles() {
            let roles = [];
            const size = answers.groupSize || 8; // Default to full set if logic fails, though it shouldn't
            
            // Logique de sélection
            roles.push(ROLES_DATA.find(r => r.id === 'coordinateur'));

            if (answers.outputType === 'written') roles.push(ROLES_DATA.find(r => r.id === 'scribe'));
            else if (answers.outputType === 'oral') roles.push(ROLES_DATA.find(r => r.id === 'orateur'));
            else if (answers.outputType === 'creative') roles.push(ROLES_DATA.find(r => r.id === 'designer'));

            if (answers.duration === 'short' || answers.outputType === 'logic') {
                if (!roles.find(r => r.id === 'gardien_temps')) roles.push(ROLES_DATA.find(r => r.id === 'gardien_temps'));
            }

            const priorities = [];
            if (answers.context === 'conflict') priorities.push('mediateur');
            if (answers.context === 'depth' || answers.outputType === 'written') priorities.push('chercheur');
            if (answers.context === 'focus') priorities.push('gardien_temps');
            
            priorities.push('critique', 'scribe', 'orateur', 'designer', 'chercheur', 'mediateur');

            for (let id of priorities) {
                if (roles.length < size && !roles.find(r => r.id === id)) {
                    roles.push(ROLES_DATA.find(r => r.id === id));
                }
            }
            
            if (roles.length > size) roles = roles.slice(0, size);
            selectedRoles = roles;
            setMode('results');
        }

        // --- RENDU HTML (TEMPLATES) ---

        function renderApp() {
            const app = document.getElementById('app');
            app.innerHTML = ''; // Clear content

            if (currentMode === 'home') {
                app.innerHTML = getHomeHTML();
            } else if (currentMode === 'quiz') {
                app.innerHTML = getQuizHTML();
            } else if (currentMode === 'results') {
                app.innerHTML = getResultsHTML();
            }

            lucide.createIcons(); // Refresh icons
        }

        function getHomeHTML() {
            const t = TRANSLATIONS[currentLang];
            return `
                <div class="flex flex-col items-center fade-in max-w-5xl mx-auto">
                    <div class="text-center space-y-6 py-12 px-4">
                        <div class="bg-gradient-to-br from-indigo-100 to-purple-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto shadow-inner">
                            <i data-lucide="brain-circuit" class="w-12 h-12 text-indigo-600"></i>
                        </div>
                        <h1 class="text-4xl md:text-6xl font-extrabold text-gray-900 tracking-tight">${t.appTitle}</h1>
                        <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">${t.subtitle}</p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 w-full max-w-3xl px-6 mb-16">
                        <button onclick="selectedRoles = ROLES_DATA; setMode('results')" class="group relative flex flex-col items-center p-8 bg-white border-2 border-gray-100 rounded-3xl hover:border-indigo-500 hover:shadow-xl transition-all duration-300 text-left cursor-pointer">
                            <div class="absolute top-6 right-6 text-gray-300 group-hover:text-indigo-500 transition-colors"><i data-lucide="layout" class="w-8 h-8"></i></div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-3">${t.startFull}</h3>
                            <p class="text-base text-gray-500">${t.startFullDesc}</p>
                        </button>

                        <button onclick="setMode('quiz')" class="group relative flex flex-col items-center p-8 bg-indigo-600 text-white rounded-3xl hover:bg-indigo-700 hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 text-left shadow-lg shadow-indigo-200 cursor-pointer">
                            <div class="absolute top-6 right-6 text-indigo-300 group-hover:text-white transition-colors"><i data-lucide="sparkles" class="w-8 h-8"></i></div>
                            <h3 class="text-2xl font-bold mb-3">${t.startQuiz}</h3>
                            <p class="text-base text-indigo-100">${t.startQuizDesc}</p>
                        </button>
                    </div>

                    <div class="w-full bg-white rounded-3xl shadow-sm border border-gray-100 p-8 md:p-12 space-y-12">
                        <div class="flex flex-col md:flex-row gap-8 items-start">
                            <div class="bg-amber-100 p-4 rounded-2xl shrink-0"><i data-lucide="lightbulb" class="w-8 h-8 text-amber-600"></i></div>
                            <div class="space-y-3">
                                <h2 class="text-2xl font-bold text-gray-900">${t.introTitle}</h2>
                                <p class="text-gray-600 leading-relaxed text-lg">${t.introText}</p>
                            </div>
                        </div>
                        <hr class="border-gray-100" />
                        <div class="space-y-8">
                            <h2 class="text-2xl font-bold text-gray-900 text-center">${t.usageTitle}</h2>
                            <div class="grid md:grid-cols-3 gap-8">
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3 text-emerald-600 font-bold text-lg"><span class="flex items-center justify-center w-8 h-8 rounded-full bg-emerald-100 text-sm">1</span>${t.usage1Title}</div>
                                    <p class="text-gray-600 text-sm leading-relaxed">${t.usage1Text}</p>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3 text-blue-600 font-bold text-lg"><span class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-sm">2</span>${t.usage2Title}</div>
                                    <p class="text-gray-600 text-sm leading-relaxed">${t.usage2Text}</p>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3 text-rose-600 font-bold text-lg"><span class="flex items-center justify-center w-8 h-8 rounded-full bg-rose-100 text-sm">3</span>${t.usage3Title}</div>
                                    <p class="text-gray-600 text-sm leading-relaxed">${t.usage3Text}</p>
                                    <div class="bg-rose-50 p-3 rounded-lg text-xs text-rose-800 italic border border-rose-100">${t.usage3Ex}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getQuizHTML() {
            const t = TRANSLATIONS[currentLang];
            const questions = getQuestions();
            const q = questions[quizStep];
            const progress = ((quizStep + 1) / questions.length) * 100;

            const optionsHTML = q.options.map(opt => `
                <button onclick="handleQuizAnswer('${opt.value}')" class="w-full p-5 text-left rounded-2xl border-2 border-gray-100 hover:border-indigo-500 hover:bg-indigo-50 transition-all duration-200 flex justify-between items-center group cursor-pointer">
                    <span class="font-medium text-gray-700 group-hover:text-indigo-900 text-lg">${opt.label}</span>
                    <i data-lucide="arrow-right" class="opacity-0 group-hover:opacity-100 text-indigo-600 transition-opacity w-5 h-5"></i>
                </button>
            `).join('');

            return `
                <div class="max-w-xl mx-auto mt-10">
                    <div class="mb-8">
                        <div class="flex justify-between text-xs font-semibold uppercase text-gray-400 mb-2">
                            <span>${t.question} ${quizStep + 1}/${questions.length}</span>
                            <span>${Math.round(progress)}%</span>
                        </div>
                        <div class="h-2 w-full bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-600 transition-all duration-500 ease-out" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    <div class="bg-white p-8 rounded-3xl shadow-xl border border-gray-100 slide-in">
                        <h2 class="text-2xl font-bold text-gray-800 mb-8">${q.question}</h2>
                        <div class="space-y-3">${optionsHTML}</div>
                    </div>
                    <button onclick="resetApp()" class="mt-8 flex items-center justify-center w-full gap-2 text-gray-400 hover:text-gray-600 transition-colors cursor-pointer">
                        <i data-lucide="rotate-ccw" class="w-4 h-4"></i> ${t.cancel}
                    </button>
                </div>
            `;
        }

        function getResultsHTML() {
            const t = TRANSLATIONS[currentLang];
            const subtitle = answers.groupSize ? 
                (currentLang === 'fr' ? `${selectedRoles.length} cartes générées pour un groupe de ${answers.groupSize} personnes` : `${selectedRoles.length} cards generated for a group of ${answers.groupSize} people`) 
                : (currentLang === 'fr' ? `${selectedRoles.length} cartes générées` : `${selectedRoles.length} cards generated`);

            const cardsHTML = selectedRoles.map(role => `
                <div class="print-card-wrapper">
                    ${getCardHTML(role)}
                </div>
            `).join('');

            const backsHTML = selectedRoles.map(role => `
                <div class="print-card-wrapper">
                    ${getCardBackHTML(role)}
                </div>
            `).join('');

            return `
                <div class="flex flex-col h-full bg-gray-50 print:bg-white">
                    <!-- Toolbar -->
                    <div class="no-print bg-white border-b border-gray-200 px-6 py-4 sticky top-0 z-20 shadow-sm">
                        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div class="flex items-center gap-4">
                                <button onclick="resetApp()" class="p-2 rounded-full hover:bg-gray-100 text-gray-500 transition-colors flex items-center gap-2 cursor-pointer">
                                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                                    <span class="text-sm font-medium hidden md:inline">${t.backToHome}</span>
                                </button>
                                <div class="h-6 w-px bg-gray-200 hidden md:block"></div>
                                <div>
                                    <h2 class="text-lg font-bold text-gray-900">${t.generatedTitle}</h2>
                                    <p class="text-xs text-gray-500">${subtitle}</p>
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row items-center gap-4">
                                <label class="flex items-center gap-2 text-sm text-gray-700 font-medium cursor-pointer bg-gray-50 px-3 py-2 rounded-lg border border-gray-200 hover:bg-gray-100 select-none">
                                    <input type="checkbox" ${printBacks ? 'checked' : ''} onchange="togglePrintBacks(this.checked)" class="rounded text-indigo-600 focus:ring-indigo-500">
                                    ${t.withBacks}
                                </label>
                                <button onclick="window.print()" class="flex items-center gap-2 bg-indigo-600 text-white px-6 py-2.5 rounded-xl font-semibold hover:bg-indigo-700 transition-colors shadow-md shadow-indigo-200 cursor-pointer">
                                    <i data-lucide="printer" class="w-4 h-4"></i> ${t.printBtn}
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Printable Content -->
                    <div class="flex-grow p-8 print:p-0">
                        <div class="max-w-7xl mx-auto print:max-w-none print:w-full">
                            
                            ${printBacks ? `
                            <div class="no-print mb-8 bg-blue-50 text-blue-800 p-4 rounded-xl border border-blue-100 flex items-start gap-3 shadow-sm max-w-3xl mx-auto">
                                <div class="mt-1"><i data-lucide="info" class="w-5 h-5"></i></div>
                                <div>
                                    <p class="font-bold text-sm mb-1">${t.printTipTitle}</p>
                                    <p class="text-sm opacity-90 leading-relaxed">${t.printTip}</p>
                                </div>
                            </div>
                            ` : ''}

                            <!-- Faces Grid -->
                            <div class="print-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 justify-items-center">
                                ${cardsHTML}
                            </div>

                            ${printBacks ? `
                            <div class="hidden print:block print-break-before"></div>
                            <div class="print-grid mt-12 print:mt-0">
                                <div class="no-print text-center mb-6 pt-8 border-t border-gray-200">
                                    <span class="bg-gray-200 text-gray-600 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider">${t.backPreview}</span>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 justify-items-center" style="direction: ltr;">
                                    ${backsHTML}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- HTML des Cartes ---

        function getCardHTML(role) {
            const t = role.content[currentLang];
            const labels = TRANSLATIONS[currentLang];
            const tasksHTML = t.tasks.map(task => `
                <li class="text-[10px] text-gray-700 flex items-start gap-1.5 leading-tight">
                    <span class="mt-1.5 min-w-[4px] h-[4px] rounded-full bg-gradient-to-r ${role.color}"></span>
                    ${task}
                </li>
            `).join('');

            return `
                <div class="relative flex flex-col w-[63mm] h-[88mm] bg-white border-[3px] ${role.borderColor} rounded-[5mm] overflow-hidden shadow-lg print:shadow-none print:border-[2px]">
                    <div class="h-[22mm] bg-gradient-to-r ${role.color} p-2 flex flex-col items-center justify-center text-white relative">
                        <div class="absolute top-2 right-2 opacity-50"><i data-lucide="${role.icon}" class="w-4 h-4"></i></div>
                        <div class="bg-white/20 p-1.5 rounded-full backdrop-blur-sm mb-1 shadow-sm">
                            <i data-lucide="${role.icon}" class="w-6 h-6 text-white"></i>
                        </div>
                        <h3 class="text-sm font-bold uppercase tracking-wide text-center leading-tight">${t.title}</h3>
                    </div>
                    <div class="flex-grow p-3 flex flex-col gap-2 ${role.bgPattern}">
                        <div class="bg-white/80 rounded-lg p-2 border border-white shadow-sm">
                            <h4 class="text-[10px] font-bold uppercase ${role.textColor} mb-0.5 flex items-center gap-1">
                                <i data-lucide="sparkles" class="w-3 h-3"></i> ${labels.mission}
                            </h4>
                            <p class="text-[11px] font-medium text-gray-800 leading-snug">${t.mission}</p>
                        </div>
                        <div class="flex-grow">
                            <h4 class="text-[10px] font-bold uppercase text-gray-400 mb-1">${labels.tasks}</h4>
                            <ul class="space-y-1">${tasksHTML}</ul>
                        </div>
                        <div class="mt-auto pt-2 border-t ${role.borderColor}">
                            <p class="text-center italic text-[10px] font-bold ${role.textColor}">${t.phrase}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getCardBackHTML(role) {
            return `
                <div class="relative flex flex-col items-center justify-center w-[63mm] h-[88mm] bg-gradient-to-br ${role.color} rounded-[5mm] overflow-hidden print:border-[1px] print:border-gray-300">
                    <div class="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-white to-transparent scale-150"></div>
                    <div class="relative z-10 flex flex-col items-center gap-4 p-4 border-4 border-white/20 rounded-xl m-3 h-[calc(100%-1.5rem)] w-[calc(100%-1.5rem)] justify-center backdrop-blur-sm">
                        <i data-lucide="${role.icon}" class="w-12 h-12 text-white drop-shadow-md"></i>
                        <div class="w-12 h-1 bg-white/30 rounded-full"></div>
                        <i data-lucide="${role.icon}" class="w-12 h-12 text-white drop-shadow-md rotate-180 opacity-50"></i>
                    </div>
                </div>
            `;
        }

        // --- INIT ---
        renderApp();

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenges Vi-Act</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Icons (Phosphor Icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: '#6366f1', // Indigo
                        secondary: '#ec4899', // Pink
                        accent: '#facc15', // Yellow
                        surface: '#f3f4f6',
                        locked: '#94a3b8',
                    },
                    animation: {
                        'shake': 'shake 0.82s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f8fafc; }
        .slide-enter { animation: slideIn 0.4s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- Navbar -->
    <nav class="w-full bg-white shadow-sm p-4 flex justify-between items-center z-10 shrink-0">
        <div class="flex items-center gap-2">
            <i class="ph-fill ph-trophy text-accent text-2xl"></i>
            <span class="font-bold text-primary tracking-wide uppercase text-sm md:text-base">Vi-Act Challenges</span>
        </div>
        <button onclick="toggleLanguage()" class="flex items-center gap-2 px-4 py-2 rounded-full bg-slate-100 hover:bg-slate-200 transition text-sm font-semibold text-slate-700">
            <i class="ph ph-globe"></i>
            <span id="lang-btn-text">EN</span>
        </button>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col items-center justify-center p-4 relative overflow-y-auto w-full">
        
        <!-- Background Elements -->
        <div class="absolute top-10 left-10 w-64 h-64 bg-primary/5 rounded-full blur-3xl pointer-events-none"></div>
        <div class="absolute bottom-10 right-10 w-64 h-64 bg-secondary/5 rounded-full blur-3xl pointer-events-none"></div>

        <!-- Dynamic Container -->
        <div id="app-container" class="w-full max-w-3xl mx-auto flex flex-col items-center">
            <!-- Content injected via JS -->
        </div>

    </main>

    <!-- Password Modal (Hidden by default) -->
    <div id="password-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl m-4">
            <h3 class="text-xl font-bold mb-2 flex items-center gap-2 text-gray-800"><i class="ph-fill ph-lock-key text-primary"></i> Mot de passe requis</h3>
            <p class="text-sm text-gray-500 mb-4" id="modal-desc">Entrez le mot de passe pour débloquer cette mission.</p>
            <input type="password" id="password-input" class="w-full border border-gray-300 rounded-lg p-3 mb-4 focus:ring-2 focus:ring-primary outline-none" placeholder="Mot de passe">
            <div class="flex justify-end gap-2">
                <button onclick="closeModal()" class="px-4 py-2 rounded-lg text-gray-500 hover:bg-gray-100 font-medium">Annuler</button>
                <button onclick="checkPassword()" class="px-4 py-2 rounded-lg bg-primary text-white font-bold hover:bg-indigo-700">Débloquer</button>
            </div>
        </div>
    </div>

    <script>
        // --- STATE ---
        let state = {
            lang: 'fr',
            view: 'cover', // cover, menu, mission1, mission2, mission3, celebration
            mission3Locked: true,
            slideIndex: 0 // For multi-step missions
        };

        // --- CONTENT DATA ---
        const content = {
            fr: {
                langBtn: "Switch to English",
                common: { back: "Retour au menu", next: "Suivant", start: "Commencer", finish: "Terminer la mission" },
                cover: {
                    title: "Challenges Vi-Act",
                    subtitle: "Rencontre les jeunes & passe à l'action !",
                    btn: "Voir les missions"
                },
                menu: {
                    title: "Tableau de bord des missions",
                    desc: "Complète les missions dans l'ordre de ton choix, mais garde le meilleur pour la fin.",
                    m1: { title: "Mission 1 : Entretien", desc: "Va à la rencontre des jeunes.", status: "Accès libre" },
                    m2: { title: "Mission 2 : Panorama", desc: "Complète la Mindmap avec tes recherches.", status: "Accès libre" },
                    m3: { title: "Mission 3 : Personas", desc: "Crée et partage tes profils types.", status: "Verrouillé", hint: "Mot de passe requis" }
                },
                mission1: [
                    {
                        title: "Mission 1 : Entretien Empathique",
                        type: "intro",
                        body: `<p class="mb-4">Votre mission : Chercher des pépites (histoires, anecdotes) pour devenir des travailleurs jeunesse connectés.</p>`
                    },
                    {
                        title: "Préparation",
                        type: "step",
                        icon: "ph-file-text",
                        body: `
                        <ul class="space-y-4">
                            <li class="flex gap-3 bg-white p-3 rounded-lg border border-gray-100">
                                <i class="ph-fill ph-download-simple text-primary text-xl mt-1"></i>
                                <div><strong>Guide :</strong> Récupère le guide de l'entretien empathique (PDF).</div>
                            </li>
                            <li class="flex gap-3 bg-white p-3 rounded-lg border border-gray-100">
                                <i class="ph-fill ph-notebook text-secondary text-xl mt-1"></i>
                                <div><strong>Matériel :</strong> Prépare de quoi noter. Astuce : faites-le en binôme (1 pose les questions, 1 note).</div>
                            </li>
                        </ul>`
                    },
                    {
                        title: "Action !",
                        type: "step",
                        icon: "ph-microphone-stage",
                        body: `
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-indigo-50 p-4 rounded-xl text-center"><div class="font-bold text-2xl text-primary">2</div><div class="text-xs">Jeunes</div></div>
                            <div class="bg-indigo-50 p-4 rounded-xl text-center"><div class="font-bold text-2xl text-primary">20</div><div class="text-xs">Minutes/Entretien</div></div>
                        </div>
                        <p class="text-sm text-gray-600">En face à face ou visio. Utilise le guide comme une boussole, laisse la conversation vivre.</p>`
                    },
                    {
                        title: "Mise au propre",
                        type: "step",
                        icon: "ph-pencil-simple-slash",
                        body: `<p class="mb-4">Mets tes notes au propre tant que c'est frais.</p>
                        <div class="bg-green-50 text-green-800 p-4 rounded-xl border border-green-100 flex items-center gap-3">
                            <i class="ph-fill ph-check-circle text-2xl"></i>
                            <div><strong>Transforme tes brouillons :</strong><br>En pépites exploitables pour la suite.</div>
                        </div>`
                    },
                    {
                        title: "Questionnaire",
                        type: "step",
                        icon: "ph-clipboard-text",
                        body: `
                        <p class="mb-4 text-center text-sm font-semibold">Dernière étape de cette mission :</p>
                        <div class="w-full bg-indigo-50 border-2 border-indigo-100 rounded-xl p-6 text-center mb-4">
                            <i class="ph-fill ph-arrow-fat-down text-4xl text-primary mb-2 animate-bounce"></i>
                            <h4 class="font-bold text-lg text-gray-800 mb-1">Mon expérience d'entretien empathique</h4>
                            <p class="text-sm text-gray-600">Remplis le questionnaire situé juste en dessous de cette fenêtre.</p>
                        </div>`
                    }
                ],
                // Mission 2 est maintenant un tableau d'étapes (slides)
                mission2: [
                    {
                        title: "Mission 2 : Panoramas Jeunes",
                        type: "intro",
                        icon: "ph-map-trifold",
                        body: `
                        <p class="text-lg text-gray-700 mb-4 text-center">Vous avez découvert les panoramas lors de la formation synchrone. Il est temps de les enrichir !</p>
                        <p class="text-sm text-gray-500 text-center">Cette mission consiste à faire des recherches et à connecter les points.</p>
                        `
                    },
                    {
                        title: "Recherche & Action",
                        type: "step",
                        icon: "ph-magnifying-glass",
                        body: `
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 text-left space-y-4">
                            <div class="flex gap-3">
                                <span class="bg-accent text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">1</span>
                                <p class="text-sm">Allez chercher de l'information supplémentaire selon les méthodes vues ensemble.</p>
                            </div>
                            <div class="flex gap-3">
                                <span class="bg-accent text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">2</span>
                                <p class="text-sm">Faites apparaître ces nouvelles informations directement sur la <strong>Mindmap</strong> du cours.</p>
                            </div>
                        </div>
                        `
                    },
                    {
                        title: "Questionnaire",
                        type: "step",
                        icon: "ph-clipboard-text",
                        body: `
                        <p class="mb-4 text-center text-sm font-semibold">Pour valider cette mission :</p>
                        <div class="w-full bg-pink-50 border-2 border-pink-100 rounded-xl p-6 text-center mb-4">
                            <i class="ph-fill ph-arrow-fat-down text-4xl text-secondary mb-2 animate-bounce"></i>
                            <h4 class="font-bold text-lg text-gray-800 mb-1">Mini questionnaire 2</h4>
                            <p class="text-sm text-gray-600 font-medium">"Panorama : mes actions futures"</p>
                            <p class="text-xs text-gray-500 mt-2">Répondez-y juste en dessous de cette fenêtre.</p>
                        </div>`
                    }
                ],
                mission3: [
                    {
                        title: "Mission 3 : Les Personas",
                        type: "intro",
                        body: `<p class="text-lg text-gray-600">Super, tu as dû apprendre tellement de choses aujourd'hui !</p>
                        <p class="mt-2 text-gray-600">Nous avons hâte d'en découvrir un peu plus. Nous te proposons une façon créative de partager ces découvertes.</p>`
                    },
                    {
                        title: "Comprendre",
                        type: "step",
                        icon: "ph-monitor-play",
                        body: `<div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 text-center">
                            <i class="ph-fill ph-presentation-chart text-4xl text-primary mb-3"></i>
                            <h4 class="font-bold text-gray-800 mb-2">Avant de commencer</h4>
                            <p class="text-sm text-gray-600">Va regarder la présentation sur les Personas dans Howspace.</p>
                        </div>`
                    },
                    {
                        title: "Créer (Le Builder)",
                        type: "step",
                        icon: "ph-wrench",
                        body: `
                        <p class="text-sm mb-4">À l'aide du <strong>Vi-Act Persona Builder</strong> (ou autre outil) :</p>

                        <!-- Added creative freedom block -->
                        <div class="bg-blue-50 p-3 rounded-lg text-xs text-blue-800 mb-4 border border-blue-100 flex items-start gap-2">
                            <i class="ph-fill ph-paint-brush text-lg"></i>
                            <div><strong>Liberté créative :</strong> Tu peux utiliser Canva, Word, ou même dessiner ton persona à la main et prendre une photo !</div>
                        </div>

                        <ol class="list-decimal ml-5 space-y-3 text-sm text-gray-700 marker:font-bold marker:text-primary">
                            <li>Construis <strong>2 personas</strong> basés sur tes entretiens.</li>
                            <li>Télécharge-les (PDF ou Image).</li>
                            <li>Renomme-les ainsi : <br><code class="bg-gray-200 px-1 rounded text-xs">Ton Prénom Nom - Persona [Nom du persona]</code></li>
                            <li>Upload les deux fichiers dans la zone nommée : <strong>"Galerie des personas"</strong>.</li>
                        </ol>`
                    },
                    {
                        title: "La Galerie",
                        type: "step",
                        icon: "ph-users-three",
                        body: `
                        <p class="text-sm font-bold text-gray-800 mb-3">Dernière étape : l'échange !</p>
                        <div class="bg-white p-4 rounded-xl border border-gray-200 text-sm space-y-3">
                            <p>Va explorer la "Galerie de Personas" sur Howspace et commente au moins <strong>2 personas</strong> de tes collègues.</p>
                            <div class="bg-yellow-50 p-3 rounded-lg border-l-4 border-yellow-400 text-xs text-gray-700">
                                <strong>Réponds à ces questions :</strong>
                                <ul class="list-disc ml-4 mt-1 space-y-1">
                                    <li>“Ce persona t’aide surtout à comprendre quoi ?”</li>
                                    <li>“Une question que tu aimerais encore poser à ce persona ?”</li>
                                </ul>
                            </div>
                        </div>`
                    },
                    {
                        title: "Étape Cruciale & Obligatoire",
                        type: "step",
                        icon: "ph-warning-circle",
                        body: `
                        <div class="text-center">
                            <p class="mb-4 text-gray-700 font-bold text-red-500">Avant de célébrer, cette étape est indispensable pour l'évaluation du module.</p>
                            <div class="bg-indigo-50 border border-indigo-200 p-5 rounded-xl shadow-sm">
                                <i class="ph-fill ph-list-checks text-4xl text-primary mb-2"></i>
                                <h4 class="font-bold text-gray-800 mb-2">Évaluation du module</h4>
                                <p class="text-sm text-gray-600 mb-3 text-justify">
                                    Prenez <strong>10 minutes</strong> pour répondre au <strong>questionnaire d'évaluation</strong> situé tout en bas de la page.
                                </p>
                                <p class="text-xs text-indigo-600 italic">
                                    "C'est très important pour voir ce qui a fonctionné, ce qui vous a plu et pour nous améliorer, mais aussi pour mesurer vos progrès au fil de la formation."
                                </p>
                            </div>
                        </div>`
                    }
                ],
                celebration: {
                    title: "Félicitations !",
                    msg: "Tu as validé toutes les étapes du parcours Vi-Act Challenges. Bravo pour ton engagement !",
                    btn: "Retour à l'accueil"
                }
            },
            en: {
                langBtn: "Passer en Français",
                common: { back: "Back to Menu", next: "Next", start: "Start", finish: "Finish Mission" },
                cover: {
                    title: "Vi-Act Challenges",
                    subtitle: "Meet the youth & take action!",
                    btn: "View Missions"
                },
                menu: {
                    title: "Mission Dashboard",
                    desc: "Complete the missions in any order, but save the best for last.",
                    m1: { title: "Mission 1: Interview", desc: "Meet young people.", status: "Open Access" },
                    m2: { title: "Mission 2: Panorama", desc: "Complete the Mindmap with research.", status: "Open Access" },
                    m3: { title: "Mission 3: Personas", desc: "Create and share your profiles.", status: "Locked", hint: "Password required" }
                },
                mission1: [
                    {
                        title: "Mission 1: Empathic Interview",
                        type: "intro",
                        body: `<p class="mb-4">Your mission: Hunt for nuggets (stories, anecdotes) to become connected youth workers.</p>`
                    },
                    {
                        title: "Preparation",
                        type: "step",
                        icon: "ph-file-text",
                        body: `
                        <ul class="space-y-4">
                            <li class="flex gap-3 bg-white p-3 rounded-lg border border-gray-100">
                                <i class="ph-fill ph-download-simple text-primary text-xl mt-1"></i>
                                <div><strong>Guide:</strong> Download the Empathic Interview Guide (PDF).</div>
                            </li>
                            <li class="flex gap-3 bg-white p-3 rounded-lg border border-gray-100">
                                <i class="ph-fill ph-notebook text-secondary text-xl mt-1"></i>
                                <div><strong>Tools:</strong> Prepare notes. Tip: Do it in pairs (1 asks, 1 writes).</div>
                            </li>
                        </ul>`
                    },
                    {
                        title: "Action!",
                        type: "step",
                        icon: "ph-microphone-stage",
                        body: `
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-indigo-50 p-4 rounded-xl text-center"><div class="font-bold text-2xl text-primary">2</div><div class="text-xs">Youths</div></div>
                            <div class="bg-indigo-50 p-4 rounded-xl text-center"><div class="font-bold text-2xl text-primary">20</div><div class="text-xs">Mins/Interview</div></div>
                        </div>
                        <p class="text-sm text-gray-600">Face-to-face or video. Use the guide as a compass, let the conversation flow.</p>`
                    },
                    {
                        title: "Clean Up",
                        type: "step",
                        icon: "ph-pencil-simple-slash",
                        body: `<p class="mb-4">Clean up your notes while fresh.</p>
                        <div class="bg-green-50 text-green-800 p-4 rounded-xl border border-green-100 flex items-center gap-3">
                            <i class="ph-fill ph-check-circle text-2xl"></i>
                            <div><strong>Once notes are ready:</strong><br>Proceed to the next step.</div>
                        </div>`
                    },
                    {
                        title: "Questionnaire",
                        type: "step",
                        icon: "ph-clipboard-text",
                        body: `
                        <p class="mb-4 text-center text-sm font-semibold">Last step of this mission:</p>
                        <div class="w-full bg-indigo-50 border-2 border-indigo-100 rounded-xl p-6 text-center mb-4">
                            <i class="ph-fill ph-arrow-fat-down text-4xl text-primary mb-2 animate-bounce"></i>
                            <h4 class="font-bold text-lg text-gray-800 mb-1">My Empathic Interview Experience</h4>
                            <p class="text-sm text-gray-600">Fill out the questionnaire located just below this window.</p>
                        </div>`
                    }
                ],
                mission2: [
                    {
                        title: "Mission 2: Youth Panoramas",
                        type: "intro",
                        icon: "ph-map-trifold",
                        body: `
                        <p class="text-lg text-gray-700 mb-4 text-center">You discovered panoramas during synchronous training. Time to enrich them!</p>
                        <p class="text-sm text-gray-500 text-center">This mission consists of researching and connecting dots.</p>
                        `
                    },
                    {
                        title: "Research & Action",
                        type: "step",
                        icon: "ph-magnifying-glass",
                        body: `
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 text-left space-y-4">
                            <div class="flex gap-3">
                                <span class="bg-accent text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">1</span>
                                <p class="text-sm">Search for additional information using the methods discussed.</p>
                            </div>
                            <div class="flex gap-3">
                                <span class="bg-accent text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">2</span>
                                <p class="text-sm">Add this new information directly to the course <strong>Mindmap</strong>.</p>
                            </div>
                        </div>
                        `
                    },
                    {
                        title: "Questionnaire",
                        type: "step",
                        icon: "ph-clipboard-text",
                        body: `
                        <p class="mb-4 text-center text-sm font-semibold">To complete this mission:</p>
                        <div class="w-full bg-pink-50 border-2 border-pink-100 rounded-xl p-6 text-center mb-4">
                            <i class="ph-fill ph-arrow-fat-down text-4xl text-secondary mb-2 animate-bounce"></i>
                            <h4 class="font-bold text-lg text-gray-800 mb-1">Mini Questionnaire 2</h4>
                            <p class="text-sm text-gray-600 font-medium">"Panorama: my future actions"</p>
                            <p class="text-xs text-gray-500 mt-2">Answer it just below this window.</p>
                        </div>`
                    }
                ],
                mission3: [
                    {
                        title: "Mission 3: Personas",
                        type: "intro",
                        body: `<p class="text-lg text-gray-600">Great, you must have learned so much today!</p>
                        <p class="mt-2 text-gray-600">We can't wait to discover more. Here is a creative way to share these discoveries.</p>`
                    },
                    {
                        title: "Understand",
                        type: "step",
                        icon: "ph-monitor-play",
                        body: `<div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 text-center">
                            <i class="ph-fill ph-presentation-chart text-4xl text-primary mb-3"></i>
                            <h4 class="font-bold text-gray-800 mb-2">Before you start</h4>
                            <p class="text-sm text-gray-600">Watch the presentation on Personas in Howspace.</p>
                        </div>`
                    },
                    {
                        title: "Create (The Builder)",
                        type: "step",
                        icon: "ph-wrench",
                        body: `
                        <p class="text-sm mb-4">Using the <strong>Vi-Act Persona Builder</strong> (or any other tool):</p>

                        <!-- Added creative freedom block -->
                        <div class="bg-blue-50 p-3 rounded-lg text-xs text-blue-800 mb-4 border border-blue-100 flex items-start gap-2">
                            <i class="ph-fill ph-paint-brush text-lg"></i>
                            <div><strong>Creative Freedom:</strong> You can use Canva, Word, or even draw it by hand and take a photo!</div>
                        </div>

                        <ol class="list-decimal ml-5 space-y-3 text-sm text-gray-700 marker:font-bold marker:text-primary">
                            <li>Build <strong>2 personas</strong> based on your interviews.</li>
                            <li>Download them (PDF or Image).</li>
                            <li>Rename them: <br><code class="bg-gray-200 px-1 rounded text-xs">Your Name - Persona [Persona Name]</code></li>
                            <li>Upload both files in the area named: <strong>"Galerie des personas"</strong>.</li>
                        </ol>`
                    },
                    {
                        title: "The Gallery",
                        type: "step",
                        icon: "ph-users-three",
                        body: `
                        <p class="text-sm font-bold text-gray-800 mb-3">Exchange!</p>
                        <div class="bg-white p-4 rounded-xl border border-gray-200 text-sm space-y-3">
                            <p>Explore the "Persona Gallery" on Howspace and comment on at least <strong>2 personas</strong> from colleagues.</p>
                            <div class="bg-yellow-50 p-3 rounded-lg border-l-4 border-yellow-400 text-xs text-gray-700">
                                <strong>Answer these questions:</strong>
                                <ul class="list-disc ml-4 mt-1 space-y-1">
                                    <li>“What does this persona help you understand most?”</li>
                                    <li>“One question you would still like to ask this persona?”</li>
                                </ul>
                            </div>
                        </div>`
                    },
                    {
                        title: "Crucial & Mandatory Step",
                        type: "step",
                        icon: "ph-warning-circle",
                        body: `
                        <div class="text-center">
                            <p class="mb-4 text-gray-700 font-bold text-red-500">Before celebrating, this step is mandatory for module evaluation.</p>
                            <div class="bg-indigo-50 border border-indigo-200 p-5 rounded-xl shadow-sm">
                                <i class="ph-fill ph-list-checks text-4xl text-primary mb-2"></i>
                                <h4 class="font-bold text-gray-800 mb-2">Module Evaluation</h4>
                                <p class="text-sm text-gray-600 mb-3 text-justify">
                                    Please take <strong>10 minutes</strong> to answer the <strong>evaluation questionnaire</strong> located at the very bottom of the page.
                                </p>
                                <p class="text-xs text-indigo-600 italic">
                                    "It's very important to see what worked, what you liked, and how we can improve, but also to measure your progress throughout the training."
                                </p>
                            </div>
                        </div>`
                    }
                ],
                celebration: {
                    title: "Congratulations!",
                    msg: "You have validated all steps of the Vi-Act Challenges journey. Well done!",
                    btn: "Back to Home"
                }
            }
        };

        // --- RENDER FUNCTIONS ---

        const container = document.getElementById('app-container');
        const langText = document.getElementById('lang-btn-text');
        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('password-input');

        function toggleLanguage() {
            state.lang = state.lang === 'fr' ? 'en' : 'fr';
            render();
        }

        function setView(viewName) {
            state.view = viewName;
            state.slideIndex = 0; // Reset slides when changing view
            render();
        }

        function unlockMission3() {
            document.getElementById('modal-desc').textContent = state.lang === 'fr' ? "Entrez le mot de passe" : "Enter password";
            passwordModal.classList.remove('hidden');
            passwordInput.value = '';
            passwordInput.focus();
        }

        function closeModal() {
            passwordModal.classList.add('hidden');
        }

        function checkPassword() {
            const val = passwordInput.value.trim().toLowerCase();
            if (val === 'knowthem') {
                state.mission3Locked = false;
                closeModal();
                setView('mission3');
            } else {
                passwordInput.classList.add('animate-shake');
                passwordInput.style.borderColor = '#ef4444';
                setTimeout(() => {
                    passwordInput.classList.remove('animate-shake');
                    passwordInput.style.borderColor = '#d1d5db';
                }, 820);
            }
        }

        function nextSlide(missionKey) {
            const max = content[state.lang][missionKey].length - 1;
            if (state.slideIndex < max) {
                state.slideIndex++;
                render();
            } else {
                if (missionKey === 'mission3') {
                    setView('celebration');
                } else {
                    setView('menu');
                }
            }
        }

        function prevSlide() {
            if (state.slideIndex > 0) {
                state.slideIndex--;
                render();
            } else {
                setView('menu');
            }
        }

        function render() {
            const t = content[state.lang];
            langText.textContent = t.langBtn;
            container.innerHTML = ''; // Clear

            // COVER VIEW
            if (state.view === 'cover') {
                container.innerHTML = `
                    <div class="text-center glass-panel p-10 rounded-3xl shadow-2xl slide-enter max-w-lg">
                        <div class="w-24 h-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6 text-primary">
                            <i class="ph-fill ph-trophy text-5xl"></i>
                        </div>
                        <h1 class="text-4xl font-extrabold mb-2 text-gray-800 leading-tight">${t.cover.title}</h1>
                        <p class="text-gray-500 mb-8">${t.cover.subtitle}</p>
                        <button onclick="setView('menu')" class="px-8 py-3 rounded-xl bg-primary text-white font-bold hover:bg-indigo-700 transition shadow-lg hover:shadow-indigo-500/30 w-full flex justify-center items-center gap-2 group">
                            ${t.cover.btn} <i class="ph-bold ph-arrow-right group-hover:translate-x-1 transition-transform"></i>
                        </button>
                    </div>
                `;
            }

            // MENU DASHBOARD VIEW
            else if (state.view === 'menu') {
                const m3Class = state.mission3Locked 
                    ? "opacity-80 grayscale cursor-pointer" 
                    : "cursor-pointer bg-white hover:bg-indigo-50";
                
                const m3Icon = state.mission3Locked ? "ph-lock-key" : "ph-user-focus";
                const m3Action = state.mission3Locked ? "unlockMission3()" : "setView('mission3')";
                const m3StatusColor = state.mission3Locked ? "text-gray-500 bg-gray-100" : "text-green-600 bg-green-100";

                container.innerHTML = `
                    <div class="w-full slide-enter">
                        <h2 class="text-2xl font-bold mb-2 text-center">${t.menu.title}</h2>
                        <p class="text-gray-500 text-center mb-8 max-w-md mx-auto text-sm">${t.menu.desc}</p>
                        
                        <div class="grid gap-4 md:grid-cols-1">
                            <!-- Mission 1 -->
                            <div onclick="setView('mission1')" class="glass-panel p-5 rounded-2xl flex items-center gap-4 cursor-pointer card-hover transition-all">
                                <div class="w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 shrink-0">
                                    <i class="ph-fill ph-chats text-2xl"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-lg">${t.menu.m1.title}</h3>
                                    <p class="text-xs text-gray-500">${t.menu.m1.desc}</p>
                                </div>
                                <i class="ph-bold ph-caret-right text-gray-300"></i>
                            </div>

                            <!-- Mission 2 -->
                            <div onclick="setView('mission2')" class="glass-panel p-5 rounded-2xl flex items-center gap-4 cursor-pointer card-hover transition-all">
                                <div class="w-14 h-14 rounded-full bg-pink-100 flex items-center justify-center text-secondary shrink-0">
                                    <i class="ph-fill ph-map-trifold text-2xl"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-lg">${t.menu.m2.title}</h3>
                                    <p class="text-xs text-gray-500">${t.menu.m2.desc}</p>
                                </div>
                                <i class="ph-bold ph-caret-right text-gray-300"></i>
                            </div>

                            <!-- Mission 3 (Conditional) -->
                            <div onclick="${m3Action}" class="glass-panel p-5 rounded-2xl flex items-center gap-4 transition-all card-hover ${m3Class} border-2 ${state.mission3Locked ? 'border-dashed border-gray-300' : 'border-indigo-100'}">
                                <div class="w-14 h-14 rounded-full ${state.mission3Locked ? 'bg-gray-200 text-gray-500' : 'bg-indigo-100 text-primary'} flex items-center justify-center shrink-0">
                                    <i class="ph-fill ${m3Icon} text-2xl"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-center mb-1">
                                        <h3 class="font-bold text-lg text-gray-800">${t.menu.m3.title}</h3>
                                        <span class="text-[10px] px-2 py-0.5 rounded-full font-bold uppercase tracking-wider ${m3StatusColor}">
                                            ${t.menu.m3.status}
                                        </span>
                                    </div>
                                    <p class="text-xs text-gray-500 flex items-center gap-1">
                                        ${t.menu.m3.desc}
                                        ${state.mission3Locked ? `<span class="ml-2 text-xs text-red-400 font-semibold"><i class="ph-bold ph-key"></i> ${t.menu.m3.hint}</span>` : ''}
                                    </p>
                                </div>
                                <i class="ph-bold ph-caret-right text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                `;
            }

            // MISSION 1, 2, & 3 (SLIDES)
            // Modification: J'ai ajouté 'mission2' à la condition pour utiliser le système de slides
            else if (state.view === 'mission1' || state.view === 'mission2' || state.view === 'mission3') {
                const missionKey = state.view;
                const slides = t[missionKey];
                const currentSlide = slides[state.slideIndex];
                const isFirst = state.slideIndex === 0;
                const isLast = state.slideIndex === slides.length - 1;
                
                const progress = ((state.slideIndex + 1) / slides.length) * 100;

                container.innerHTML = `
                    <div class="w-full max-w-2xl slide-enter">
                        <!-- Header / Progress -->
                        <div class="mb-6 flex items-center justify-between">
                             <button onclick="setView('menu')" class="text-xs font-bold text-gray-400 hover:text-primary flex items-center gap-1">
                                <i class="ph-bold ph-x"></i> Menu
                            </button>
                            <div class="w-32 h-1.5 bg-gray-200 rounded-full">
                                <div class="h-full bg-primary rounded-full transition-all duration-300" style="width: ${progress}%"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-8 md:p-10 rounded-3xl shadow-xl min-h-[400px] flex flex-col relative">
                            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                                ${currentSlide.icon ? `<i class="ph-fill ${currentSlide.icon} text-secondary"></i>` : ''}
                                ${currentSlide.title}
                            </h2>
                            <div class="flex-1 text-gray-600 leading-relaxed text-base">
                                ${currentSlide.body}
                            </div>
                            
                            <!-- Buttons -->
                            <div class="mt-8 flex justify-between items-center pt-6 border-t border-gray-100">
                                <button onclick="prevSlide()" class="px-4 py-2 rounded-lg text-gray-500 hover:bg-gray-50 font-medium flex items-center gap-2 ${isFirst ? 'invisible' : ''}">
                                    <i class="ph-bold ph-arrow-left"></i> ${t.common.back}
                                </button>
                                <button onclick="nextSlide('${missionKey}')" class="px-6 py-2 rounded-xl bg-primary text-white font-bold hover:bg-indigo-700 shadow-md flex items-center gap-2">
                                    ${isLast ? t.common.finish : t.common.next} <i class="ph-bold ph-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // CELEBRATION
            else if (state.view === 'celebration') {
                container.innerHTML = `
                    <div class="text-center slide-enter glass-panel p-10 rounded-3xl shadow-2xl max-w-md">
                        <div class="mb-6 animate-bounce">
                            <i class="ph-fill ph-confetti text-6xl text-accent drop-shadow-md"></i>
                        </div>
                        <h2 class="text-3xl font-bold mb-4 text-gray-800">${t.celebration.title}</h2>
                        <p class="text-gray-600 mb-8">${t.celebration.msg}</p>
                        <button onclick="setView('menu')" class="px-6 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition flex items-center gap-2 mx-auto">
                            <i class="ph-bold ph-house"></i> ${t.celebration.btn}
                        </button>
                    </div>
                `;
            }
        }

        // Initialize
        render();

        // Allow Enter key on password
        passwordInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                checkPassword();
            }
        });

    </script>
</body>
</html>

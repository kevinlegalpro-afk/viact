import React, { useState } from 'react';
import { Clock, Globe, Calendar, Info, CheckCircle2, Zap, Users, Coffee, Sun } from 'lucide-react';

// --- DATA & CONFIGURATION ---

const TIMEZONES = [
  { id: 'fr', label: 'ðŸ‡«ðŸ‡·/ðŸ‡§ðŸ‡ª France/Belgique', offset: 0 },
  { id: 'ro', label: 'ðŸ‡·ðŸ‡´/ðŸ‡§ðŸ‡¬ Roumanie/Bulgarie', offset: 1 },
  { id: 'mg', label: 'ðŸ‡²ðŸ‡¬ Madagascar', offset: 2 },
  { id: 'sc', label: 'ðŸ‡¸ðŸ‡¨/ðŸ‡²ðŸ‡º Seychelles/Maurice', offset: 3 },
];

const STYLES = {
  elearning: {
    // RÃ©tablissement des couleurs vives (Vert) + Texte plus foncÃ© pour la lisibilitÃ©
    base: 'bg-emerald-200/80 border-l-4 border-emerald-600 text-emerald-950',
    icon: <CheckCircle2 className="w-3.5 h-3.5 text-emerald-700" />,
    label: { fr: 'E-learning', en: 'E-learning' }
  },
  synchrone: {
    // RÃ©tablissement des couleurs vives (Violet)
    base: 'bg-purple-200/80 border-l-4 border-purple-600 text-purple-950',
    icon: <Users className="w-3.5 h-3.5 text-purple-700" />,
    label: { fr: 'Synchrone', en: 'Synchronous' }
  },
  blended: {
    // RÃ©tablissement des couleurs vives (Bleu)
    base: 'bg-blue-200/80 border-l-4 border-blue-600 text-blue-950',
    icon: <Zap className="w-3.5 h-3.5 text-blue-700" />,
    label: { fr: 'Blended', en: 'Blended' }
  },
  break: {
    // Gris lÃ©gÃ¨rement plus soutenu pour les pauses
    base: 'bg-slate-200 border-l-4 border-slate-400 text-slate-600 italic font-medium',
    icon: <Coffee className="w-3.5 h-3.5 text-slate-500" />,
    label: { fr: 'Pause', en: 'Break' }
  },
  open: {
    // Orange/Ambre doux pour les ouvertures
    base: 'bg-amber-100 border-l-4 border-amber-500 text-amber-900',
    icon: <Sun className="w-3.5 h-3.5 text-amber-600" />,
    label: { fr: 'Ouverture/Reflexion', en: 'Open/Reflection' }
  },
};

const SCHEDULE = [
  {
    day: 1,
    events: [
      { start: '07:30', duration: 30, type: 'open', title: { fr: 'Ouverture salle virtuelle', en: 'Virtual room opening' } },
      { start: '08:00', duration: 120, type: 'synchrone', title: { fr: '1. Onboarding / Ouverture de la formation', en: '1. Onboarding / Opening of the training' } },
      { start: '10:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '10:30', duration: 120, type: 'synchrone', title: { fr: "2. Animateur/travailleur jeunesse digital, c'est quoi ?", en: 'Digital youth worker / digital youth facilitator â€” what is it?' } },
      { start: '12:30', duration: 60, type: 'break', title: { fr: 'DÃ©jeuner', en: 'Lunch' } },
      { start: '13:30', duration: 210, type: 'blended', title: { fr: '3. Les rÃ©alitÃ©s des jeunes dans nos contextes locaux\nPartie 1: Analyse de besoins & entretiens empathiques\nPartie 2: Recherche et rÃ©colte d\'informations', en: "Young people's realities in our local contexts\nPart 1: Needs analysis & empathetic interviews\nPart 2: Research and data collection" } },
      { start: '17:00', duration: 30, type: 'open', title: { fr: 'Temps de rÃ©flexion', en: 'Reflection Time' } },
    ]
  },
  {
    day: 2,
    events: [
      { start: '07:30', duration: 30, type: 'open', title: { fr: 'Ouverture salle virtuelle', en: 'Virtual room opening' } },
      { start: '08:00', duration: 120, type: 'elearning', title: { fr: '4. MÃ©thodologies d\'apprentissage actifs, apprentissage tout au long de la vie, andragogie.', en: 'Active learning methodologies, lifelong learning, andragogy.' } },
      { start: '10:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '10:30', duration: 120, type: 'synchrone', title: { fr: '5. CrÃ©er un espace participatif & interculturel', en: 'Creating a participatory & intercultural space' } },
      { start: '12:30', duration: 60, type: 'break', title: { fr: 'DÃ©jeuner', en: 'Lunch' } },
      { start: '13:30', duration: 90, type: 'synchrone', title: { fr: '6. Accompagnement des processus crÃ©atifs des jeunes - initiation Ã  une mÃ©thodologie', en: "Supporting young people's creative processes â€“ introduction to a methodology" } },
      { start: '15:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '15:30', duration: 90, type: 'elearning', title: { fr: '7. MÃ©thodologies d\'accompagnement d\'initiatives jeunes - bonnes pratiques et tutorat', en: 'Methodologies for supporting youth initiatives â€“ Best practice and tutoring practices' } },
      { start: '17:00', duration: 30, type: 'open', title: { fr: 'Temps de rÃ©flexion', en: 'Reflection Time' } },
    ]
  },
  {
    day: 3,
    events: [
      { start: '07:30', duration: 30, type: 'open', title: { fr: 'Ouverture salle virtuelle', en: 'Virtual room opening' } },
      { start: '08:00', duration: 120, type: 'elearning', title: { fr: '8. Budget, administratif et logistique: Une boite Ã  outils', en: 'Budget, administration and logistics: a toolbox' } },
      { start: '10:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '10:30', duration: 120, type: 'synchrone', title: { fr: '9. Cartographier les partenaires & construire une coalition d\'apprentissage', en: 'Mapping partners & building a learning coalition' } },
      { start: '12:30', duration: 60, type: 'break', title: { fr: 'DÃ©jeuner', en: 'Lunch' } },
      { start: '13:30', duration: 90, type: 'blended', title: { fr: '10. Encourager et coordonner la vie bÃ©nÃ©vole par et pour les jeunes', en: 'Encouraging and coordinating volunteer life by and for young people' } },
      { start: '15:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '15:30', duration: 90, type: 'elearning', title: { fr: '11. Du besoin aux objectifs d\'apprentissage et indicateurs', en: 'From needs to learning objectives and indicators' } },
      { start: '17:00', duration: 30, type: 'open', title: { fr: 'Temps de rÃ©flexion', en: 'Reflection Time' } },
    ]
  },
  {
    day: 4,
    events: [
      { start: '07:30', duration: 30, type: 'open', title: { fr: 'Ouverture salle virtuelle', en: 'Virtual room opening' } },
      { start: '08:00', duration: 120, type: 'synchrone', title: { fr: '12. Concevoir une progression pÃ©dagogique pour une journÃ©e d\'animation', en: 'Designing a pedagogical progression for a day long activity' } },
      { start: '10:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '10:30', duration: 120, type: 'blended', title: { fr: '13. Construire le dÃ©roulÃ© d\'une journÃ©e d\'animations', en: 'Building the activity outline' } },
      { start: '12:30', duration: 60, type: 'break', title: { fr: 'DÃ©jeuner', en: 'Lunch' } },
      { start: '13:30', duration: 90, type: 'blended', title: { fr: '13. (Suite) Construire le dÃ©roulÃ© d\'une journÃ©e d\'animations', en: '(Cont.) Building the activity outline' } },
      { start: '15:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '15:30', duration: 90, type: 'elearning', title: { fr: '14. Garantir inclusion, sÃ©curitÃ© & aspects lÃ©gaux', en: 'Ensuring inclusion, safety & legal aspects' } },
      { start: '17:00', duration: 30, type: 'open', title: { fr: 'Temps de rÃ©flexion', en: 'Reflection Time' } },
    ]
  },
  {
    day: 5,
    events: [
      { start: '07:30', duration: 30, type: 'open', title: { fr: 'Ouverture salle virtuelle', en: 'Virtual room opening' } },
      { start: '08:00', duration: 120, type: 'blended', title: { fr: '15. Posture de facilitation & apprentissage actif', en: 'Facilitation posture & active learning' } },
      { start: '10:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '10:30', duration: 120, type: 'blended', title: { fr: '15. (Suite) Posture de facilitation & apprentissage actif', en: '(Cont.) Facilitation posture & active learning' } },
      { start: '12:30', duration: 60, type: 'break', title: { fr: 'DÃ©jeuner', en: 'Lunch' } },
      { start: '13:30', duration: 90, type: 'blended', title: { fr: '16. Comprendre les dynamiques de groupe, gÃ©rer les situations difficiles & les conflits', en: 'Understanding group dynamics, managing difficult situations & conflicts' } },
      { start: '15:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '15:30', duration: 90, type: 'synchrone', title: { fr: '17. Ã‰valuation formative, conduites de dÃ©briefings & ajustements "en temps rÃ©el"', en: 'Formative assessment, debriefing practices & "real-time" adjustments' } },
      { start: '17:00', duration: 30, type: 'open', title: { fr: 'Temps de rÃ©flexion', en: 'Reflection Time' } },
    ]
  },
  {
    day: 6,
    events: [
      { start: '07:30', duration: 30, type: 'open', title: { fr: 'Ouverture salle virtuelle', en: 'Virtual room opening' } },
      { start: '08:00', duration: 120, type: 'elearning', title: { fr: '18. PrÃ©parer l\'Ã©valuation & la capitalisation', en: 'Preparing evaluation & knowledge capitalization' } },
      { start: '10:00', duration: 30, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '10:30', duration: 120, type: 'blended', title: { fr: '19. Reconnaissance des apprentissages & Youthpass', en: 'Recognition of learning & Youthpass' } },
      { start: '12:30', duration: 60, type: 'break', title: { fr: 'DÃ©jeuner', en: 'Lunch' } },
      { start: '13:30', duration: 70, type: 'blended', title: { fr: '20. Promouvoir les initiatives de jeunesse & rendre leur impact visible', en: 'Promoting youth initiatives & making their impact visible' } },
      { start: '14:40', duration: 20, type: 'break', title: { fr: 'Pause', en: 'Break' } },
      { start: '15:00', duration: 120, type: 'synchrone', title: { fr: '21. Plan de dÃ©veloppement professionnel & clÃ´ture', en: 'Professional development plan & closing' } },
      { start: '17:00', duration: 30, type: 'open', title: { fr: 'Temps de rÃ©flexion', en: 'Reflection Time' } },
    ]
  }
];

const adjustTime = (baseTime, offsetHours) => {
  const [h, m] = baseTime.split(':').map(Number);
  let newH = h + offsetHours;
  if (newH >= 24) newH -= 24;
  return `${newH.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
};

const getEventStyle = (type) => STYLES[type] || STYLES.open;

export default function AgendaApp() {
  const [lang, setLang] = useState('fr');
  const [timezone, setTimezone] = useState(TIMEZONES[0]);

  return (
    <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-800">
      
      {/* HEADER - Fixed height */}
      <header className="flex-none bg-white z-50 border-b border-slate-200 shadow-sm px-6 py-4">
        <div className="max-w-[1920px] mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
          <div>
            <h1 className="text-2xl font-black text-slate-800 flex items-center gap-3 tracking-tight">
              <div className="p-2 bg-indigo-100 rounded-lg">
                 <Calendar className="w-6 h-6 text-indigo-700" />
              </div>
              {lang === 'fr' ? 'AGENDA DE FORMATION' : 'TRAINING AGENDA'}
            </h1>
          </div>

          <div className="flex flex-wrap items-center gap-4">
             {/* Legend */}
            <div className="hidden xl:flex items-center gap-4 text-xs font-semibold text-slate-600 bg-slate-100/50 py-1.5 px-4 rounded-full border border-slate-200">
              <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded-full bg-emerald-500 shadow-sm"></div>E-learning</div>
              <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded-full bg-purple-500 shadow-sm"></div>Synchrone</div>
              <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded-full bg-blue-500 shadow-sm"></div>Blended</div>
            </div>

            <div className="h-8 w-px bg-slate-200 hidden md:block"></div>

            {/* Controls */}
            <div className="flex items-center gap-3">
              <div className="flex items-center gap-2 bg-white hover:bg-slate-50 transition-colors rounded-lg p-1 px-3 border border-slate-200 shadow-sm">
                <Globe className="w-4 h-4 text-slate-400" />
                <select 
                  value={timezone.id} 
                  onChange={(e) => setTimezone(TIMEZONES.find(t => t.id === e.target.value))}
                  className="bg-transparent border-none text-sm font-semibold text-slate-700 focus:ring-0 cursor-pointer py-1 outline-none min-w-[140px]"
                >
                  {TIMEZONES.map(tz => (
                    <option key={tz.id} value={tz.id}>{tz.label} (+{tz.offset}h)</option>
                  ))}
                </select>
              </div>

              <div className="flex bg-slate-100 p-1 rounded-lg border border-slate-200 shadow-inner">
                <button 
                  onClick={() => setLang('fr')}
                  className={`px-3 py-1 text-xs font-bold rounded-md transition-all ${lang === 'fr' ? 'bg-white text-indigo-700 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}
                >
                  FR
                </button>
                <button 
                  onClick={() => setLang('en')}
                  className={`px-3 py-1 text-xs font-bold rounded-md transition-all ${lang === 'en' ? 'bg-white text-indigo-700 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}
                >
                  EN
                </button>
              </div>
            </div>
          </div>
        </div>
      </header>

      {/* MOBILE LEGEND */}
      <div className="xl:hidden flex-none bg-white border-b border-slate-200 p-2 flex flex-wrap gap-4 text-xs justify-center font-medium text-slate-600">
        <div className="flex items-center gap-1.5"><div className="w-3 h-3 bg-emerald-200 border border-emerald-500 rounded-sm"></div>E-learning</div>
        <div className="flex items-center gap-1.5"><div className="w-3 h-3 bg-purple-200 border border-purple-500 rounded-sm"></div>Synchrone</div>
        <div className="flex items-center gap-1.5"><div className="w-3 h-3 bg-blue-200 border border-blue-500 rounded-sm"></div>Blended</div>
      </div>

      {/* MAIN CONTENT - Scrollable area */}
      <main className="flex-grow overflow-x-auto overflow-y-auto bg-slate-100/50 p-6">
        
        {/* FORCED GRID: 
            - min-w-[1200px] ensures the grid never squashes columns below 200px each. 
            - grid-cols-6 enforces exactly 6 columns.
            - This guarantees ONE ROW.
        */}
        <div className="grid grid-cols-6 gap-4 min-w-[1200px] mx-auto max-w-[1920px]">
          
          {SCHEDULE.map((dayData, index) => (
            <div key={index} className="flex flex-col group">
              {/* Day Header */}
              <div className="bg-white border-x border-t border-slate-200 p-4 rounded-t-xl text-center shadow-sm relative overflow-hidden mb-2 group-hover:-translate-y-1 transition-transform duration-300">
                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
                 <span className="text-[10px] uppercase tracking-widest text-slate-400 font-bold block mb-1">
                   {lang === 'fr' ? 'Agenda' : 'Schedule'}
                 </span>
                 <span className="text-xl font-black text-slate-800">
                   {lang === 'fr' ? `JOUR ${dayData.day}` : `DAY ${dayData.day}`}
                 </span>
              </div>

              {/* Events Container */}
              <div className="flex flex-col gap-2">
                {dayData.events.map((evt, evtIndex) => {
                  const localStartTime = adjustTime(evt.start, timezone.offset);
                  const styleData = getEventStyle(evt.type);
                  
                  // Height logic optimized for single row view
                  const heightStyle = { minHeight: `${Math.max(evt.duration * 1.4, 64)}px` };

                  return (
                    <div 
                      key={evtIndex}
                      className={`
                        ${styleData.base} 
                        rounded-lg shadow-sm p-3 flex flex-col relative
                        transition-all duration-200 hover:shadow-md hover:scale-[1.02] hover:z-10
                      `}
                      style={heightStyle}
                    >
                      {/* Top Row: Time & Icon */}
                      <div className="flex justify-between items-start mb-2 border-b border-black/5 pb-1.5">
                        <div className="flex items-center gap-1.5 font-mono text-xs font-bold opacity-80 mix-blend-multiply">
                          <Clock className="w-3.5 h-3.5" />
                          {localStartTime}
                        </div>
                        {evt.type !== 'break' && evt.type !== 'open' && (
                           <div title={styleData.label[lang]}>{styleData.icon}</div>
                        )}
                      </div>
                      
                      {/* Content Title - AMÃ‰LIORATION DU TEXTE ICI */}
                      <div className="flex-grow whitespace-pre-line leading-snug font-semibold text-[11px] lg:text-xs tracking-wide drop-shadow-sm">
                        {evt.title[lang]}
                      </div>

                      {/* Duration Tag */}
                      {evt.duration > 30 && (
                        <div className="mt-1 text-[9px] font-bold opacity-40 text-right uppercase tracking-wider">
                          {Math.floor(evt.duration / 60)}h{evt.duration % 60 > 0 ? evt.duration % 60 : ''}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          ))}
        </div>
        
        {/* INFO FOOTER */}
        <div className="max-w-[1200px] mx-auto mt-8 text-center opacity-70 hover:opacity-100 transition-opacity">
           <div className="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-full shadow-sm border border-slate-200 text-xs text-slate-500">
              <Info className="w-3.5 h-3.5 text-indigo-400" />
              <p>
                {lang === 'fr' 
                  ? 'L\'ouverture de la salle est fixÃ©e Ã  07:30 (Heure de Paris/CET). Les horaires ci-dessus s\'ajustent Ã  votre choix.' 
                  : 'Room opening is fixed at 07:30 (Paris Time/CET). The schedules above adapt to your selection.'}
              </p>
           </div>
        </div>

      </main>
    </div>
  );
}
